databaseChangeLog:
- changeSet:
      id: 1.0.0/1
      author: aksenova
      changes:
        - createTable:
            tableName: importancelevel
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: level_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
        - createTable:
            tableName: interactionstatus
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: status_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                 
        - createTable:
            tableName: iteractioncategory
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: category_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
        - createTable:
            tableName: interactiondescription
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: direction 
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: duration 
                  type: int4 
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: logon_type 
                  type: bytea 
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: protocol 
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: reason 
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: starttime 
                  type: timestamp 
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: "action" 
                  type: int4 
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: actions
                    references: iteractioncategory(id)
              - column:
                  name: importance 
                  type: int4 
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: importances
                    references: iteractioncategory(id)
              - column:
                  name: status 
                  type: int4 
                  constraints:
                    nullable: True
                    unique: false                    
                    foreignKeyName: statuses
                    references: iteractioncategory(id)
        - createTable:
            tableName: tcpflag
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: flag_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
- changeSet:
      id: 1.0.0/2
      author: aksenova
      changes:      
        - createTable:
            tableName: datapayload
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: bytes_total
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: bytes_in
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: bytes_out
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: packets_total
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: packets_in
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: packets_out
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: interface
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: msgid
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: origintime
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: recvfile
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: tcpflag
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: tcp
                    references: tcpflag(id) 
              - column:
                  name: time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux1
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux2
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux3
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux4
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux5
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux6
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux7
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux8
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux9
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: aux10
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
        - createTable:
            tableName: raws
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: raw_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: datapayload_id
                  type: int4
                  constraints:
                    nullable: false
                    unique: false
                    foreignKeyName: data_descr_fk
                    references: datapayload(id)       
        - createTable:
            tableName: languages
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: locale
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                  
        - createTable:
            tableName: rule
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: rule_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: ruleversion
                  type: int8
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: lang_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: rule_descr_fk
                    references: languages(id)  
        - createTable:
            tableName: usecase_category
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: category
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: subcategory
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false               
- changeSet:
      id: 1.0.0/3
      author: aksenova
      changes:        
        - createTable:
            tableName: usecase
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: usecase_id
                  type: varchar
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: lang_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: lang
                    references: languages(id)
              - column:
                  name: category_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: category
                    references: usecase_category(id)
        - createTable:
            tableName: counterpart
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: counter_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
        - createTable:
            tableName: privilege
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: privilege_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false            
        - createTable:
            tableName: entity
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: domain
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: group
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: counter_object_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: objects
                    references: counterpart(id)
              - column:
                  name: counter_subject_id
                  type: int
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: subjects
                    references: counterpart(id)
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: lang_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: version
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: property
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: state
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: value
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: vendor
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: privileges
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: privileges
                    references: privilege(id)
              - column:
                  name: path
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false   
              - column:
                  name: subjectinfo_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
              - column:
                  name: objectinfo_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false   
        - createTable:
            tableName: customer_user
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: login
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
              - column:
                  name: email
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: customer_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: first_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: last_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: phone
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: mobile
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: customer_otrs_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true 
              - column:
                  name: userposition
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false   
              - column:
                  name: positioncat
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: midle_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: mail
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
- changeSet:
      id: 1.0.0/4
      author: aksenova
      changes:        
        - createTable:
            tableName: organizations
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: short_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true 
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: active_from
                  type: date
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: active_to
                  type: date
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: org_otrs_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: id_customer
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: user_for_key
                    references: customer_user(id)
              - column:
                  name: active
                  type: bool
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: lang_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: org_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
        - createTable:
            tableName: host_status
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: fqdn
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: hostname
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: ip
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: mac
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: first_seen
                  type: date
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: last_seen
                  type: date
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: org_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: organizations
                    references: organizations(short_name)
              - column:
                  name: unique_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true
        - createTable:
            tableName: asset
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: fqdn
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: hostname
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: ip
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: mac
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: first_seen
                  type: date
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: last_seen
                  type: date
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: hostdomain
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: server_status
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: server_criticality
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: itop_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: org_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: org_descr_fk
                    references: organizations(short_name)
              - column:
                  name: subsys
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: is_collector
                  type: bool
                  constraints:
                    nullable: True
                    unique: false 
        - addUniqueConstraint:   
            columnNames:  ip, hostname, org_id  
            constraintName:  asset_un   
            schemaName:  public  
            tableName:  asset       
        - createTable:
            tableName: vendors
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: vendor_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true 
- changeSet:
      id: 1.0.0/5
      author: aksenova
      changes:        
        - createTable:
            tableName: group_vendor
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: vendor_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: group_vendor_fk
                    references: vendors(id)
              - column:
                  name: title
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false    
        - createTable:
            tableName: natinfo
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: hostname
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: ip
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: port
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
        - createTable:
            tableName: severitylevel
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: level_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
        - createTable:
            tableName: eventsourcecategory
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: category_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false      
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
        - createTable:
            tableName: service
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: criticality
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
- changeSet:
      id: 1.0.0/6
      author: aksenova
      changes:        
        - createTable:
            tableName: ticket_priority
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: otrs_id
                  type: int8
                  constraints:
                    nullable: True
                    unique: true
        - createTable:
            tableName: ticket_lock_type
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
        - createTable:
            tableName: ticket_type
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
        - createTable:
            tableName: queue
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: otrs_id
                  type: int8
                  constraints:
                    nullable: True
                    unique: true 
        - createTable:
            tableName: ticket_state_type
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
- changeSet:
      id: 1.0.0/7
      author: aksenova
      changes:                     
        - createTable:
            tableName: ticket_state
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: state_type
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: state_descr_fk
                    references: ticket_state_type(id) 
        - createTable:
            tableName: ticket_history_type
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
        - createTable:
            tableName: sla
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
              - column:
                  name: first_response_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: first_response_notify
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: update_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: update_notify
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: solution_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false 
              - column:
                  name: solution_notify
                  type: int4
                  constraints:
                    nullable: True
                    unique: false                     
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: login
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: otrs_id
                  type: int8
                  constraints:
                    nullable: True
                    unique: true  
              - column:
                  name: first_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
              - column:
                  name: last_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false  
        - createTable:
            tableName: article
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: ticket_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: article_sender_type_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: communication_channel_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: is_visible_for_customer
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: search_index_needs_rebuild
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: insert_fingerprint
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: create_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: create_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: create_fk
                    references: users(id)                    
              - column: 
                  name: change_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: change_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: change_fk
                    references: users(id)
              - column: 
                  name: otrs_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: true 
- changeSet:
      id: 1.0.0/8
      author: aksenova
      changes:                     
        - createTable:
            tableName: article_data_mime
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: article_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: true 
              - column: 
                  name: a_from
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_reply_to
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_to
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_cc 
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_bcc
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_subject
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_message_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_message_id_md5
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_in_reply_to
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_references
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_content_type 
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: a_body
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: incoming_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: content_path
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: create_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: create_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: create_fk
                    references: users(id)                    
              - column: 
                  name: change_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: change_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false                     
                    foreignKeyName: change_fk
                    references: users(id)                    
        - createTable:
            tableName: ticket
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: title
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: queue_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: queue_fk
                    references: queue(id)                    
              - column: 
                  name: ticket_lock_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: lock_fk
                    references: ticket_lock_type(id)                    
              - column: 
                  name: type_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: type_fk
                    references: ticket_type(id)
              - column: 
                  name: service_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: sirvice_fk
                    references: service(id)
              - column: 
                  name: sla_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: sla_fk
                    references: sla(id)
              - column: 
                  name: ticket_priority_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: ticket_priority_fk
                    references: ticket_priority(id)
              - column: 
                  name: ticket_state_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: ticket_state_fk
                    references: ticket_state(id)
              - column: 
                  name: customer_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: customer_user_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: timeout
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: until_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: escalation_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: escalation_update_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: escalation_response_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: escalation_solution_time
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: ticket_id
                  type: int8
                  constraints:
                    nullable: True
                    unique: true
              - column: 
                  name: ticket_tn
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: create_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: change_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: ticket_time_unit
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: root_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                    
        - createTable:
            tableName: ticket_history
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: ticket_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: type_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: type_fk
                    references: ticket_type(id)
              - column: 
                  name: queue_id 
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: queue_fk
                    references: queue(id)
              - column: 
                  name: state_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: state_fk
                    references: ticket_state(id)
              - column: 
                  name: create_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: change_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: user_id 
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: user_fk
                    references: users(id)
              - column: 
                  name: comment
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: history_type_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: history_type_fk
                    references: ticket_history_type(id)
        - createTable:
            tableName: closure_code
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: false
                    nullable: true
              - column: 
                  name: name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: valid_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: comments
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: create_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: create_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: create_fk
                    references: users(id)                    
              - column: 
                  name: change_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false                     
              - column: 
                  name: change_by
                  type: int8
                  constraints:
                    nullable: True
                    unique: false                     
                    foreignKeyName: change_fk
                    references: users(id)                    
              - column: 
                  name: type_id
                  type: int8
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: otrs_id
                  type: int4
                  constraints:
                    primaryKey: True
                    nullable: True
                    unique: true
        - createTable:
            tableName: ticket_code
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: ticket_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: ticket_fk
                    references: ticket(id)
              - column: 
                  name: code_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: code_fk
                    references: closure_code(otrs_id)               
        - createTable:
            tableName: incident
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column: 
                  name: usecase_id
                  type: varchar
                  constraints:
                    nullable: false
                    unique: false
              - column: 
                  name: detect_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: event_time
                  type: timestamp
                  constraints:
                    nullable: True
                    unique: false
              - column: 
                  name: subject_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: subject_fk
                    references: entity(id)                     
              - column: 
                  name: object_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: object_fk
                    references: entity(id)                     
              - column: 
                  name: destination_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: destination_fk
                    references: asset(id)
              - column: 
                  name: source_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: source_fk
                    references: asset(id)
              - column: 
                  name: event_source
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: event_source_fk
                    references: asset(id)                    
              - column: 
                  name: organization_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: organization_fk
                    references: organizations(short_name)                    
              - column: 
                  name: ticket_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: ticket_fk
                    references: ticket(id)                    
              - column: 
                  name: eventsourcecategory_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: eventsourcecategory_fk
                    references: eventsourcecategory(id)                    
              - column: 
                  name: rule_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                    
              - column: 
                  name: interaction
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: interaction_fk
                    references: interactiondescription(id)                     
              - column: 
                  name: data
                  type: int4
                  constraints:
                    nullable: True
                    unique: false
                    foreignKeyName: data_fk
                    references: datapayload(id)                    
              - column: 
                  name: inputId
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                    
              - column: 
                  name: inc_id
                  type: varchar
                  constraints:
                    nullable: True
                    unique: true 
              - column: 
                  name: identity_hash
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false 
              - column: 
                  name: collectorlocationhost_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: collectorlocationhost_fk
                    references: asset(id)                    
              - column: 
                  name: nat_id 
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: nat_fk
                    references: natinfo(id)                    
              - column: 
                  name: vendor_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: vendor_fk
                    references: vendors(id)                    
              - column: 
                  name: severity_level_id
                  type: int4
                  constraints:
                    nullable: True
                    unique: false 
                    foreignKeyName: severity_level_fk
                    references: severitylevel(id)
              - column:                    
                  name: raw
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false                    
- changeSet:
      id: 1.0.0/9
      author: aksenova
      changes:
        -  insert: 
            tableName: languages
            columns:
            - column:
                name: id
                value: 1
            - column:
                name: locale
                value: ru 
        -  insert: 
            tableName: languages
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: locale
                value: en 
        -  insert: 
            tableName: languages
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: locale
                value: ua                 
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: category_name
                value: AAA
            - column:
                name: description
                value: Аутентификация, авторизация, учетные записи 
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: category_name
                value: AntiVirus
            - column:
                name: description
                value: Антивирусное программное обеспечение  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: category_name
                value: ApplicationSecurity
            - column:
                name: description
                value: Защита приложений  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 4
            - column:
                name: category_name
                value: ApplicationServer
            - column:
                name: description
                value: Сервер приложений 
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 5
            - column:
                name: category_name
                value: BackupServer
            - column:
                name: description
                value: Система резервного копирования и восстановления  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 6
            - column:
                name: category_name
                value: CertificationAuthority
            - column:
                name: description
                value: Удостоверяющий центр  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 7
            - column:
                name: category_name
                value: DatabaseServer
            - column:
                name: description
                value: Сервер баз данных  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 8
            - column:
                name: category_name
                value: DhcpServer
            - column:
                name: description
                value: Сервер DHCP  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 9
            - column:
                name: category_name
                value: DirectoryService
            - column:
                name: description
                value: Служба каталогов   
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 10
            - column:
                name: category_name
                value: DLP
            - column:
                name: description
                value: DLP  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 11
            - column:
                name: category_name
                value: DnsServer
            - column:
                name: description
                value: Сервер DNS  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 12
            - column:
                name: category_name
                value: DPI
            - column:
                name: description
                value: Система DPI  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 13
            - column:
                name: category_name
                value: FileService
            - column:
                name: description
                value: Файловая служба   
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 14
            - column:
                name: category_name
                value: Firewall
            - column:
                name: description
                value: Межсетевой экран  
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 15
            - column:
                name: category_name
                value: Honeypot
            - column:
                name: description
                value: Honeypot
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 16
            - column:
                name: category_name
                value: HostSecurity
            - column:
                name: description
                value: Защита узлов
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 17
            - column:
                name: category_name
                value: IdsIps
            - column:
                name: description
                value: Ids/Ips
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 18
            - column:
                name: category_name
                value: MailServer
            - column:
                name: description
                value: Почтовый сервер
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 19
            - column:
                name: category_name
                value: MobileDevice
            - column:
                name: description
                value: Мобильное устройство
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 20
            - column:
                name: category_name
                value: NetworkDevice
            - column:
                name: description
                value: Сетевое оборудование
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 21
            - column:
                name: category_name
                value: NetworkMonitoringSystem
            - column:
                name: description
                value: Система мониторинга сети
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 22
            - column:
                name: category_name
                value: NetworkSecurity
            - column:
                name: description
                value: Защита сети
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 23
            - column:
                name: category_name
                value: OperatingSystem
            - column:
                name: description
                value: Операционная система
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 24
            - column:
                name: category_name
                value: Other
            - column:
                name: description
                value: Другое
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 25
            - column:
                name: category_name
                value: PhysicalSecurity
            - column:
                name: description
                value: Система физической защиты
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 26
            - column:
                name: category_name
                value: ProxyServer
            - column:
                name: description
                value: Прокси-сервер
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 27
            - column:
                name: category_name
                value: SCADA
            - column:
                name: description
                value: Система SCADA 
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 28
            - column:
                name: category_name
                value: SIEM
            - column:
                name: description
                value: Система SIEM
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 29
            - column:
                name: category_name
                value: StorageDevice
            - column:
                name: description
                value: Система хранения данных
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 30
            - column:
                name: category_name
                value: Telecom
            - column:
                name: description
                value: Система связи
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 31
            - column:
                name: category_name
                value: TerminalServices
            - column:
                name: description
                value: Служба удаленных рабочих столов
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 32
            - column:
                name: category_name
                value: Virtualization	
            - column:
                name: description
                value: Система виртуализации
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 33
            - column:
                name: category_name
                value: VOIP
            - column:
                name: description
                value: IP-телефония
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 34
            - column:
                name: category_name
                value: VPN
            - column:
                name: description
                value: VPN
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 35
            - column:
                name: category_name
                value: WebSecurity
            - column:
                name: description
                value: Сетевая защита
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 36
            - column:
                name: category_name
                value: WebServer
            - column:
                name: description
                value: Веб-сервер
        -  insert: 
            tableName: eventsourcecategory 
            columns:                
            - column:
                name: id
                value: 37
            - column:
                name: category_name
                value: Wireless
            - column:
                name: description
                value: Wi-Fi
        -  insert: 
            tableName: importancelevel 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: level_name
                value: INFO
            - column: 
                name: description
                value: Информационоое события
        -  insert: 
            tableName: importancelevel 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: level_name
                value: LOW
            - column:
                name: description
                value: Низкая
        -  insert: 
            tableName: importancelevel 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: level_name
                value: MEDIUM
            - column:
                name: description
                value: Средняя
        -  insert: 
            tableName: importancelevel 
            columns:                
            - column:
                name: id
                value: 4
            - column:
                name: level_name
                value: HIGH
            - column:
                name: description
                value: Высокая
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: status_name
                value: failure
            - column:
                name: description
                value: Неуспешная попытка
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: status_name
                value: success
            - column:
                name: description
                value: Успешная попытка
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: status_name
                value: ongoing
            - column:
                name: description
                value: Действие происходит в данный момент. 
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: counter_name
                value: account
            - column:
                name: description
                value: Пользователь 
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: counter_name
                value: application
            - column:
                name: description
                value: Приложение
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: counter_name
                value: host
            - column:
                name: description
                value: Узел
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 4
            - column:
                name: counter_name
                value: process
            - column:
                name: description
                value: Процесс
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 5
            - column:
                name: counter_name
                value: rule
            - column:
                name: description
                value: Правило
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 6
            - column:
                name: counter_name
                value: system
            - column:
                name: description
                value: Система
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 7
            - column:
                name: counter_name
                value: file
            - column:
                name: description
                value: Файл
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 1
            - column:
                name: flag_name
                value: SYN 
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 2
            - column:
                name: flag_name
                value:  ACK
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 3
            - column:
                name: flag_name
                value: FIN
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 4
            - column:
                name: flag_name
                value: RST
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 5
            - column:
                name: flag_name
                value: PSH 
        -  insert: 
            tableName: tcpflag
            columns:                
            - column: 
                name: id
                value: 6
            - column:
                name: flag_name
                value: URG 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 1
            - column:
                name: category_name
                value: access
            - column:
                name: description
                value: Получение доступа
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 2
            - column:
                name: category_name
                value: alert
            - column:
                name: description
                value: Получение предупреждения
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 3
            - column:
                name: category_name
                value: allow
            - column:
                name: description
                value: Разрешение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 4
            - column:
                name: category_name
                value: apply
            - column:
                name: description
                value: Применение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 5
            - column:
                name: category_name
                value: backup
            - column:
                name: description
                value: Резервное копирование
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 6
            - column:
                name: category_name
                value: bind
            - column:
                name: description
                value: Присвоение IP-адреса, добавление политики в группу
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 7
            - column:
                name: category_name
                value: call
            - column:
                name: description
                value: Звонок
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 8
            - column:
                name: category_name
                value: check
            - column:
                name: description
                value: Проверка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 9
            - column:
                name: category_name
                value: clean
            - column:
                name: description
                value: Очистка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 10
            - column:
                name: category_name
                value: close
            - column:
                name: description
                value: Закрытие
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 11
            - column:
                name: category_name
                value: configure
            - column:
                name: description
                value: Настройка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 12
            - column:
                name: category_name
                value: connect
            - column:
                name: description
                value: Соединение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 13
            - column:
                name: category_name
                value: copy
            - column:
                name: description
                value: Копирование
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 14
            - column:
                name: category_name
                value: create
            - column:
                name: description
                value: Создание
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 15
            - column:
                name: category_name
                value: decrypt
            - column:
                name: description
                value: Расшифровка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 16
            - column:
                name: category_name
                value: deliver
            - column:
                name: description
                value: Доставка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 17
            - column:
                name: category_name
                value: deny
            - column:
                name: description
                value: Запрет
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 18
            - column:
                name: category_name
                value: detect
            - column:
                name: description
                value: Обнаружение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value:  19
            - column:
                name: category_name
                value: disable
            - column:
                name: description
                value: Выключение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 20
            - column:
                name: category_name
                value: disconnect
            - column:
                name: description
                value: Разъединение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 21
            - column:
                name: category_name
                value: down
            - column:
                name: description
                value: Изменение состояния интерфейса на down (выключение)
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 22
            - column:
                name: category_name
                value: download
            - column:
                name: description
                value: Скачивание
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 23
            - column:
                name: category_name
                value: enable
            - column:
                name: description
                value: Включение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 24
            - column:
                name: category_name
                value: encrypt
            - column:
                name: description
                value: Зашифровка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 25
            - column:
                name: category_name
                value: exclude
            - column:
                name: description
                value: Исключение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 26
            - column:
                name: category_name
                value: execute
            - column:
                name: description
                value: Выполнение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 27
            - column:
                name: category_name
                value: extract
            - column:
                name: description
                value: Извлечение 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 28
            - column:
                name: category_name
                value: grant
            - column:
                name: description
                value: Предоставление права, привилегии
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 29
            - column:
                name: category_name
                value: info
            - column:
                name: description
                value: События, носящие информационный характер, без возможности выделить действия 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 30
            - column:
                name: category_name
                value: initiate
            - column:
                name: description
                value: Инициирование
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 31
            - column:
                name: category_name
                value: install
            - column:
                name: description
                value: Установка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 32
            - column:
                name: category_name
                value: leak
            - column:
                name: description
                value: Утечка данных
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 33
            - column:
                name: category_name
                value: lock
            - column:
                name: description
                value: Блокирование 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 34
            - column:
                name: category_name
                value: login
            - column:
                name: description
                value: Вход в систему
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 35
            - column:
                name: category_name
                value: logout
            - column:
                name: description
                value: Выход из системы
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 36
            - column:
                name: category_name
                value: modify
            - column:
                name: description
                value: Изменение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 37
            - column:
                name: category_name
                value: move
            - column:
                name: description
                value: Перемещение 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 38
            - column:
                name: category_name
                value: open
            - column:
                name: description
                value: Открывание
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 39
            - column:
                name: category_name
                value: print
            - column:
                name: description
                value: Распечатывание 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 40
            - column:
                name: category_name
                value: protect
            - column:
                name: description
                value: Защита
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 41
            - column:
                name: category_name
                value: quarantine
            - column:
                name: description
                value: Изолирование 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 42
            - column:
                name: category_name
                value: recieve 
            - column:
                name: description
                value: Принятие
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 43
            - column:
                name: category_name
                value: reject
            - column:
                name: description
                value: Отмена 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 44
            - column:
                name: category_name
                value: remove
            - column:
                name: description
                value: Удаление
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 45
            - column:
                name: category_name
                value: reset
            - column:
                name: description
                value: Сброс к состоянию по умолчанию 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 46
            - column:
                name: category_name
                value: restart
            - column:
                name: description
                value: Перезапуск
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 47
            - column:
                name: category_name
                value: restore
            - column:
                name: description
                value: Восстановление 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 48
            - column:
                name: category_name
                value: revoke
            - column:
                name: description
                value: Отзыв права, привилегии
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 49
            - column:
                name: category_name
                value: rollback
            - column:
                name: description
                value: Откат к предыдущему состоянию 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 50
            - column:
                name: category_name
                value: scan
            - column:
                name: description
                value: Сканирование
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 51
            - column:
                name: category_name
                value: search
            - column:
                name: description
                value: Поиск 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 52
            - column:
                name: category_name
                value: send
            - column:
                name: description
                value: Отправка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 53
            - column:
                name: category_name
                value: start
            - column:
                name: description
                value: Запуск 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 54
            - column:
                name: category_name
                value: stop
            - column:
                name: description
                value: Остановка
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 55
            - column:
                name: category_name
                value: sync
            - column:
                name: description
                value: Синхронизация
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 56
            - column:
                name: category_name
                value: terminate
            - column:
                name: description
                value:  Завершение
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 57
            - column:
                name: category_name
                value: unbind
            - column:
                name: description
                value: Удаление политики из группы, освобождение IP-адреса
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 58
            - column:
                name: category_name
                value: uninstall
            - column:
                name: description
                value: Удаление продукта 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 59
            - column:
                name: category_name
                value: unlock
            - column:
                name: description
                value: Разблокирование 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 60
            - column:
                name: category_name
                value: up
            - column:
                name: description
                value: Изменение состояния интерфейса на up (включение) 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 61
            - column:
                name: category_name
                value: update
            - column:
                name: description
                value: Обновление (минорное) 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 62
            - column:
                name: category_name
                value: upgrade
            - column:
                name: description
                value: Обновление (мажорное) 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 63
            - column:
                name: category_name
                value: upload
            - column:
                name: description
                value: Загрузка 
        -  insert: 
            tableName: iteractioncategory
            columns:                
            - column: 
                name: id
                value: 64
            - column:
                name: category_name
                value: view
            - column:
                name: description
                value:  Просмотр
- changeSet:
      id: 1.0.0/10
      author: aksenova
      changes:             
        -  createView:    
             schemaName:  public  
             selectQuery: SELECT ticket.ticket_id, CASE WHEN ticket.ticket_time_unit >= 0 AND ticket.ticket_time_unit <= 30 THEN 'Simple'ELSE CASE WHEN ticket.ticket_time_unit >= 31 AND ticket.ticket_time_unit <= 179 THEN 'Medium' ELSE CASE WHEN ticket.ticket_time_unit > 180 THEN 'Complex' ELSE CASE WHEN ticket.ticket_time_unit IS NULL AND ticket.ticket_id IS NOT NULL THEN 'Autoclose'  ELSE NULL END END END END AS complexity,ticket.ticket_time_unit FROM ticket;
             viewName:  sla_view    
- changeSet:
      id: 1.0.0/11
      author: aksenova
      changes:             
        -  createView:    
             schemaName:  public  
             selectQuery: SELECT main.id, main.ticket_id AS otrs_id, main.ticket_tn AS number, main.name AS state, main.complexity, main.ticket_time_unit AS time_spentity, main.create_time, main.change_time, r.a_body AS action_performed FROM ( SELECT ticket.id, ticket.ticket_id, ticket.ticket_tn, ticket_state.name, sla_view.complexity, sla_view.ticket_time_unit, ticket.create_time, ticket.change_time, article.otrs_id FROM ticket LEFT JOIN article ON article.ticket_id = ticket.ticket_id LEFT JOIN sla_view ON sla_view.ticket_id = ticket.ticket_id LEFT JOIN ticket_state ON ticket.ticket_state_id = ticket_state.id) main LEFT JOIN ( SELECT article_data_mime.a_body, article.otrs_id FROM article LEFT JOIN article_data_mime ON article.otrs_id = article_data_mime.article_id WHERE article_data_mime.a_subject= 'Выполнено') r USING (otrs_id);
             viewName:  ticket_view    
- changeSet:
      id: 1.0.0/12
      author: aksenova
      changes: 
        -  renameColumn:   
              columnDataType:  int  
              newColumnName:  counterpart_object_id  
              oldColumnName:  counter_object_id    
              schemaName:  public  
              tableName:  entity
        -  createView:    
            schemaName:  public  
            selectQuery:  SELECT  distinct entity.counterpart_object_id AS "category1", entity.domain, entity."group", entity.id, entity.name, entity.path, entity.property, entity.state, entity.value, entity.vendor, entity.version FROM entity JOIN incident ON entity.id = incident.object_id;
            viewName: object_view
- changeSet:
      id: 1.0.0/13
      author: aksenova
      changes: 
        -  renameColumn:   
              columnDataType:  int  
              newColumnName:  counterpart_subject_id  
              oldColumnName:  counter_subject_id    
              schemaName:  public  
              tableName:  entity               
        -  createView:    
            schemaName:  public  
            selectQuery: SELECT distinct entity.counterpart_subject_id AS "category", entity.domain, entity."group", entity.id, entity.name, entity.path, entity.privileges, entity.version  FROM entity JOIN incident  ON entity.id = incident.subject_id;
            viewName: subject_view            
- changeSet:
      id: 1.0.0/14
      author: aksenova
      changes:      
        -  createView:    
             schemaName:  public  
             selectQuery: SELECT i.inc_id AS incident_id, i.collectorlocationhost_id AS incident_collector_location_host_id, i.data AS incident_data, i.destination_id AS incident_destination_id, i.detect_time AS incident_detect_time, i.event_source AS incident_event_source, i.event_time AS incident_event_time, i.eventsourcecategory_id AS incident_event_source_category, i."inputId" AS incident_input_id, i.interaction AS incident_interaction, i.nat_id AS incident_nat_id, i.object_id AS incident_object_id, i.organization_id AS incident_organization_id, i.rule_id AS incident_rule_id, i.severity_level_id AS incident_severity_level_id, i.source_id AS incident_source_id, i.subject_id AS incident_subject_id, i.ticket_id AS incident_otrs_id, i.usecase_id AS incident_usecae_id, i.vendor_id AS incident_vendor_id, tv.id AS ticket_id, tv.action_performed AS ticket_action_performed, tv.change_time AS ticket_change_time, tv.complexity AS ticket_complexity, tv.create_time AS ticket_create_time, tv.time_spentity AS ticket_time_spentity, tv.number AS ticket_number, tv.state AS ticket_state, dp.aux1 AS data_aux1, dp.aux2 AS data_aux2, dp.aux3 AS data_aux3, dp.aux4 AS data_aux4, dp.aux5 AS data_aux5, dp.aux6 AS data_aux6, dp.aux7 AS data_aux7, dp.aux8 AS data_aux8, dp.aux9 AS data_aux9, dp.aux10 AS data_aux10, dp.bytes_in AS data_bytes_in, dp.bytes_out AS data_bytes_out, dp.bytes_total AS data_bytes_total, dp.interface AS data_interface, dp.msgid AS data_msgid, dp.origintime AS data_origintime, dp.packets_in AS data_packets_in, dp.packets_out AS data_packets_out, dp.packets_total AS data_packets_total, dp.recvfile AS data_recvfile, dp.tcpflag AS data_tcp_flag, dp."time" AS data_time, sv.category AS subject_category, sv.domain AS subject_domain, sv."group" AS subject_group, sv.name AS subject_name, sv.path AS subject_path, sv.privileges AS subject_privileges, sv.version AS subject_version, ov.category1 AS object_category, ov.domain AS object_domain, ov."group" AS object_group, ov.name AS object_name, ov.path AS object_path, ov.property AS object_property, ov.state AS object_state, ov.value AS object_value, ov.vendor AS object_vendor, ov.version AS object_version, asrc.first_seen AS source_first_seen, asrc.fqdn AS source_fqdn, asrc.hostdomain AS source_hostdomain, asrc.hostname AS source_hostname, asrc.ip AS source_ip, asrc.itop_id AS source_id, asrc.last_seen AS source_last_seen, asrc.mac AS source_mac, asrc.org_id AS source_org_id, asrc.server_criticality AS source_server_criticality, asrc.server_status AS source_server_status, asrc.subsys AS source_subsys, adn.first_seen AS destination_first_seen, adn.fqdn AS destination_fqdn, adn.hostdomain AS destination_hostdomain, adn.hostname AS destination_hostname, adn.ip AS destination_ip, adn.itop_id AS destination_itop_id, adn.last_seen AS destination_last_seen, adn.mac AS destination_mac, adn.org_id AS destination_org_id, adn.server_criticality AS destination_server_criticality, adn.server_status AS destination_server_status, adn.subsys AS destination_subsys, aes.first_seen AS event_source_first_seen, aes.fqdn AS event_source_fqdn, aes.hostdomain AS event_source_hostdomain, aes.hostname AS event_source_hostname, aes.ip AS event_source_ip, aes.itop_id AS event_source_itop_id, aes.last_seen AS event_source_last_seen, aes.mac AS event_source_mac, aes.org_id AS event_source_org_id, aes.server_criticality AS event_source_server_criticality, aes.server_status AS event_source_server_status, aes.subsys AS event_source_subsys, acl.first_seen AS collector_location_first_seen, acl.fqdn AS collector_location_fqdn, acl.hostdomain AS collector_location_hostdomain, acl.hostname AS collector_location_hostname, acl.ip AS collector_location_ip, acl.itop_id AS collector_location_itop_id, acl.last_seen AS collector_location_last_seen, acl.mac AS collector_location_mac, acl.org_id AS collector_location_org_id, acl.server_criticality AS collector_location_server_criticality, acl.server_status AS collector_location_server_status, acl.subsys AS collector_location_subsys FROM incident i LEFT JOIN ticket_view tv ON tv.id = i.ticket_id LEFT JOIN subject_view sv ON sv.id = i.subject_id LEFT JOIN object_view ov ON ov.id = i.object_id LEFT JOIN asset asrc ON asrc.id = i.source_id LEFT JOIN asset adn ON adn.id = i.destination_id LEFT JOIN asset aes ON aes.id = i.event_source LEFT JOIN asset acl ON acl.id = i.collectorlocationhost_id LEFT JOIN datapayload dp ON dp.id = i.data;
             viewName:  full_incidents_view
        -  createView:    
             schemaName:  public  
             selectQuery: SELECT f.incident_data, f.incident_detect_time, f.incident_event_source_category, f.incident_event_time, f.incident_usecae_id, f.incident_vendor_id, u.description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.collector_location_subsys, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, f.subject_category, f.subject_domain, f.subject_group, f.subject_name, f.subject_path, f.subject_privileges, f.subject_version,    cntr1.counter_name AS subject_counter_name, f.object_category, f.object_domain, f.object_group, f.object_name, f.object_path, f.object_property, f.object_state, f.object_value, f.object_vendor, f.object_version,    cntr2.counter_name AS object_counter_name, f.source_fqdn, f.source_hostdomain, f.source_hostname, f.source_ip, f.source_last_seen, f.source_mac, f.source_server_criticality, f.source_server_status, f.source_subsys, f.destination_first_seen, f.destination_fqdn, f.destination_hostdomain, f.destination_hostname, f.destination_ip, f.destination_last_seen, f.destination_mac, f.destination_server_criticality, f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain, f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, f.event_source_subsys, f.ticket_change_time, f.ticket_complexity, f.ticket_create_time, f.ticket_number, f.ticket_state,    l.locale AS language    FROM full_incidents_view f     JOIN usecase u ON f.incident_usecae_id= u.usecase_id   LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN counterpart cntr1 ON cntr1.id = f.subject_category LEFT JOIN counterpart cntr2 ON cntr2.id = f.object_category
             viewName:  translated_incidents_view 
- changeSet:
      id: 1.0.0/15
      author: aksenova
      changes:
        -  insert: 
            tableName: severitylevel
            columns:
            - column:
                name: id
                value: 1
            - column:
                name: level_name
                value: INFO
        -  insert: 
            tableName: severitylevel
            columns:
            - column:
                name: id
                value: 2
            - column:
                name: level_name
                value: LOW  
        -  insert: 
            tableName: severitylevel
            columns:
            - column:
                name: id
                value: 3
            - column:
                name: level_name
                value: MEDIUM  
        -  insert: 
            tableName: severitylevel
            columns:
            - column:
                name: id
                value: 4
            - column:
                name: level_name
                value: HIGH     
- changeSet:
      id: 1.0.0/16
      author: aksenova
      changes:
        sql: ALTER TABLE public.object_view RENAME COLUMN category1 TO category;
- changeSet:
      id: 1.0.0/17
      author: aksenova
      changes:
        sql: ALTER TABLE full_incidents_view rename COLUMN incident_usecae_id  to incident_usecase_id;   
- changeSet:
      id: 1.0.0/18
      author: aksenova
      changes:
        sql: ALTER TABLE translated_incidents_view rename COLUMN incident_usecae_id  to incident_usecase_id;        
- changeSet:
      id: 1.0.0/19
      author: aksenova
      changes: 
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 8
            - column:
                name: counter_name
                value: url
            - column:
                name: description
                value: URL
- changeSet:
      id: 1.0.0/20
      author: aksenova
      changes:
        sql: ALTER TABLE translated_incidents_view rename COLUMN ticket_time_spentity to ticket_time_spent;
        sql: ALTER TABLE public.iteractioncategory RENAME TO interactioncategory;
        sql: DROP TABLE public.importancelevel;
        sql: ALTER TABLE public.interactiondescription DROP COLUMN importance;
        sql: ALTER TABLE public.entity DROP COLUMN lang_id;
        sql: ALTER TABLE public.asset DROP COLUMN subsys;
        sql: ALTER TABLE public.incident ADD subsys varchar NULL;
        sql: ALTER TABLE public.incident DROP CONSTRAINT vendor_fk;
        sql: ALTER TABLE public.incident ADD CONSTRAINT group_vendor_fk FOREIGN KEY (vendor_id) REFERENCES public.group_vendor(id);
        sql: ALTER TABLE public.interactiondescription DROP CONSTRAINT statuses;
        sql: ALTER TABLE public.interactiondescription ADD CONSTRAINT status_fk FOREIGN KEY (status) REFERENCES public.interactionstatus(id);
- changeSet:
      id: 1.0.0/21
      author: aksenova
      changes:        
        sql: ALTER TABLE public.iteractioncategory RENAME TO interactioncategory; DROP TABLE public.importancelevel; ALTER TABLE public.interactiondescription DROP COLUMN importance; ALTER TABLE public.entity DROP COLUMN lang_id; ALTER TABLE public.asset DROP COLUMN subsys CASCADE; ALTER TABLE public.incident ADD subsys varchar NULL; ALTER TABLE public.incident DROP CONSTRAINT vendor_fk; ALTER TABLE public.incident ADD CONSTRAINT group_vendor_fk FOREIGN KEY (vendor_id) REFERENCES public.group_vendor(id); ALTER TABLE public.interactiondescription DROP CONSTRAINT statuses; ALTER TABLE public.interactiondescription ADD CONSTRAINT statuses_fk FOREIGN KEY (status) REFERENCES public.interactionstatus(id);ALTER TABLE public.datapayload ALTER COLUMN origintime TYPE timestamp USING origintime::timestamp;
- changeSet:
      id: 1.0.0/22
      author: aksenova
      changes:
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 9
            - column:
                name: counter_name
                value: MalwareObject
            - column:
                name: description
                value: MalwareObject      
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 10
            - column:
                name: counter_name
                value: mailAttachment
            - column:
                name: description
                value: mailAttachment
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 11
            - column:
                name: counter_name
                value: userGroup
            - column:
                name: description
                value: userGroup
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 13
            - column:
                name: counter_name
                value: connection
            - column:
                name: description
                value: connection 
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 14
            - column:
                name: counter_name
                value: interface
            - column:
                name: description
                value: interface 
        -  insert: 
            tableName: vendors 
            columns:                
            - column:
                name: id
                value: 5
            - column:
                name: vendor_name
                value: Firewall
        -  insert: 
            tableName: vendors
            columns:                
            - column:
                name: id
                value: 6
            - column:
                name: vendor_name
                value:  AntiVirus
        -  insert: 
            tableName: group_vendor 
            columns:                
            - column:
                name: id
                value: 5
            - column:
                name: vendor_id
                value:  5
            - column:
                name: title
                value: Fortigate  
        -  insert: 
            tableName: group_vendor 
            columns:                
            - column:
                name: id
                value: 6
            - column:
                name: vendor_id
                value:  6
            - column:
                name: title
                value: Kaspersky Antivirus   
- changeSet:
      id: 1.0.0/23
      author: aksenova
      changes:
        sql: ALTER TABLE public.ticket_view RENAME COLUMN time_spentity TO time_spent;
- changeSet:
      id: 1.0.0/24
      author: aksenova
      changes:
        sql: select i.inc_id as incident_id, i.collectorlocationhost_id as incident_collector_location_host_id, i.data as incident_data, i.destination_id as incident_destination_id, i.detect_time as incident_detect_time, i.event_source as incident_event_source, i.event_time as incident_event_time, i.eventsourcecategory_id as incident_event_source_category, i."inputId" as incident_input_id, i.interaction as incident_interaction, i.nat_id as incident_nat_id, i.object_id as incident_object_id, i.organization_id as incident_organization_id, org."name" as incident_organization_full_name, i.rule_id as incident_rule_id, i.severity_level_id as incident_severity_level_id, i.source_id as incident_source_id, i.subject_id as incident_subject_id, i.ticket_id as incident_otrs_id, i.usecase_id as incident_usecase_id, i.vendor_id as incident_vendor_id, i.subsys, iad.action as interaction_action, iad.direction as interaction_direction, iad.duration as interaction_duration, iad.logon_type as interaction_logon_type, iad.protocol as interaction_protocol, iad.reason as interaction_reason, iad.starttime as interaction_start_time, iad.status as interaction_status, ni.hostname as incident_nat_hostname, ni.ip as incident_nat_ip, ni.port as incident_nat_port, ven.vendor_name as incident_vendor, gv.title as incident_vendor_product, tv.id as ticket_id, tv.action_performed as ticket_action_performed, tv.change_time as ticket_change_time, tv.complexity as ticket_complexity, tv.create_time as ticket_create_time, tv.time_spent as ticket_time_spent, tv.number as ticket_number, tv.state as ticket_state, tst."name" as ticket_state_type, sv.category as subject_category, sv.domain as subject_domain, sv.group as subject_group, sv."name" as subject_name, sv."path" as subject_path, sv.privileges as subject_privileges, sv.version as subject_version, ov.category as object_category, ov.domain as object_domain, ov.group as object_group, ov."name" as object_name, ov."path" as object_path, ov.property as object_property, ov.state as object_state, ov.value as object_value, ov.vendor as object_vendor, ov.version as object_version, asrc.first_seen as source_first_seen, asrc.fqdn as source_fqdn, asrc.hostdomain as source_hostdomain, asrc.hostname as source_hostname, asrc.ip as source_ip, asrc.itop_id as source_id, asrc.last_seen as source_last_seen, asrc.mac as source_mac, asrc.org_id as source_org_id, asrc.server_criticality as source_server_criticality, asrc.server_status as source_server_status, adn.first_seen as destination_first_seen, adn.fqdn as destination_fqdn, adn.hostdomain as destination_hostdomain, adn.hostname as destination_hostname, adn.ip as destination_ip, adn.itop_id as destination_itop_id, adn.last_seen as destination_last_seen, adn.mac as destination_mac, adn.org_id as destination_org_id, adn.server_criticality as destination_server_criticality, adn.server_status as destination_server_status, aes.first_seen as event_source_first_seen, aes.fqdn as event_source_fqdn, aes.hostdomain as event_source_hostdomain, aes.hostname as event_source_hostname, aes.ip as event_source_ip, aes.itop_id as event_source_itop_id, aes.last_seen as event_source_last_seen, aes.mac as event_source_mac, aes.org_id as event_source_org_id, aes.server_criticality as event_source_server_criticality, aes.server_status as event_source_server_status, acl.first_seen as collector_location_first_seen, acl.fqdn as collector_location_fqdn, acl.hostdomain as collector_location_hostdomain, acl.hostname as collector_location_hostname, acl.ip as collector_location_ip, acl.itop_id as collector_location_itop_id, acl.last_seen as collector_location_last_seen, acl.mac as collector_location_mac, acl.org_id as collector_location_org_id, acl.server_criticality as collector_location_server_criticality, acl.server_status as collector_location_server_status, dp.aux1 as data_aux1, dp.aux2 as data_aux2, dp.aux3 as data_aux3, dp.aux4 as data_aux4, dp.aux5 as data_aux5, dp.aux6 as data_aux6, dp.aux7 as data_aux7, dp.aux8 as data_aux8, dp.aux9 as data_aux9, dp.aux10 as data_aux10, dp.bytes_in as data_bytes_in, dp.bytes_out as data_bytes_out, dp.bytes_total as data_bytes_total, dp.interface as data_interface, dp.msgid as data_msgid, dp.origintime as data_origintime, dp.packets_in as data_packets_in, dp.packets_out as data_packets_out, dp.packets_total as data_packets_total, dp.recvfile as data_recvfile, dp.tcpflag as data_tcp_flag, dp."time" as data_time from public.incident i left join ticket_view tv on tv.id=i.ticket_id  left join ticket t on t.id=i.ticket_id left join ticket_state ts on ts.id=t.ticket_state_id left join ticket_state_type tst on ts.state_type=tst.id left join public.ticket_code tc on tc.ticket_id = tv.id left join public.subject_view sv on sv.id = i.subject_id left join public.object_view ov on ov.id = i.object_id left join public.asset asrc on asrc.id = i.source_id left join public.asset adn on adn.id = i.destination_id left join public.asset aes on aes.id = i.event_source left join public.asset acl on acl.id = i.collectorlocationhost_id left join public.datapayload dp on dp.id = i.data left join public.organizations org on org.short_name = i.organization_id left join public.interactiondescription iad on iad.id = i.interaction left join public.natinfo ni on ni.id = i.nat_id left join group_vendor as gv on gv.id=i.vendor_id left join vendors as ven on ven.id=gv.vendor_id   
- changeSet:
      id: 1.0.0/25
      author: aksenova
      changes:
        sql: CREATE OR REPLACE VIEW public.full_incidents_view AS select i.inc_id as incident_id, i.collectorlocationhost_id as incident_collector_location_host_id, i.data as incident_data, i.destination_id as incident_destination_id, i.detect_time as incident_detect_time, i.event_source as incident_event_source, i.event_time as incident_event_time, i.eventsourcecategory_id as incident_event_source_category, i."inputId" as incident_input_id, i.interaction as incident_interaction, i.nat_id as incident_nat_id, i.object_id as incident_object_id, i.organization_id as incident_organization_id, org."name" as incident_organization_full_name, i.rule_id as incident_rule_id, i.severity_level_id as incident_severity_level_id, i.source_id as incident_source_id, i.subject_id as incident_subject_id, i.ticket_id as incident_otrs_id, i.usecase_id as incident_usecase_id, i.vendor_id as incident_vendor_id, i.subsys, iad.action as interaction_action, iad.direction as interaction_direction, iad.duration as interaction_duration, iad.logon_type as interaction_logon_type, iad.protocol as interaction_protocol, iad.reason as interaction_reason, iad.starttime as interaction_start_time, iad.status as interaction_status, ni.hostname as incident_nat_hostname, ni.ip as incident_nat_ip, ni.port as incident_nat_port, ven.vendor_name as incident_vendor, gv.title as incident_vendor_product, tv.id as ticket_id, tv.action_performed as ticket_action_performed, tv.change_time as ticket_change_time, tv.complexity as ticket_complexity, tv.create_time as ticket_create_time, tv.time_spent as ticket_time_spent, tv.number as ticket_number, tv.state as ticket_state, tst."name" as ticket_state_type, sv.category as subject_category, sv.domain as subject_domain, sv.group as subject_group, sv."name" as subject_name, sv."path" as subject_path, sv.privileges as subject_privileges, sv.version as subject_version, ov.category as object_category, ov.domain as object_domain, ov.group as object_group, ov."name" as object_name, ov."path" as object_path, ov.property as object_property, ov.state as object_state, ov.value as object_value, ov.vendor as object_vendor, ov.version as object_version, asrc.first_seen as source_first_seen, asrc.fqdn as source_fqdn, asrc.hostdomain as source_hostdomain, asrc.hostname as source_hostname, asrc.ip as source_ip, asrc.itop_id as source_id, asrc.last_seen as source_last_seen, asrc.mac as source_mac, asrc.org_id as source_org_id, asrc.server_criticality as source_server_criticality, asrc.server_status as source_server_status, adn.first_seen as destination_first_seen, adn.fqdn as destination_fqdn, adn.hostdomain as destination_hostdomain, adn.hostname as destination_hostname, adn.ip as destination_ip, adn.itop_id as destination_itop_id, adn.last_seen as destination_last_seen, adn.mac as destination_mac, adn.org_id as destination_org_id, adn.server_criticality as destination_server_criticality, adn.server_status as destination_server_status, aes.first_seen as event_source_first_seen, aes.fqdn as event_source_fqdn, aes.hostdomain as event_source_hostdomain, aes.hostname as event_source_hostname, aes.ip as event_source_ip, aes.itop_id as event_source_itop_id, aes.last_seen as event_source_last_seen, aes.mac as event_source_mac, aes.org_id as event_source_org_id, aes.server_criticality as event_source_server_criticality, aes.server_status as event_source_server_status, acl.first_seen as collector_location_first_seen, acl.fqdn as collector_location_fqdn, acl.hostdomain as collector_location_hostdomain, acl.hostname as collector_location_hostname, acl.ip as collector_location_ip, acl.itop_id as collector_location_itop_id, acl.last_seen as collector_location_last_seen, acl.mac as collector_location_mac, acl.org_id as collector_location_org_id, acl.server_criticality as collector_location_server_criticality, acl.server_status as collector_location_server_status, dp.aux1 as data_aux1, dp.aux2 as data_aux2, dp.aux3 as data_aux3, dp.aux4 as data_aux4, dp.aux5 as data_aux5, dp.aux6 as data_aux6, dp.aux7 as data_aux7, dp.aux8 as data_aux8, dp.aux9 as data_aux9, dp.aux10 as data_aux10, dp.bytes_in as data_bytes_in, dp.bytes_out as data_bytes_out, dp.bytes_total as data_bytes_total, dp.interface as data_interface, dp.msgid as data_msgid, dp.origintime as data_origintime, dp.packets_in as data_packets_in, dp.packets_out as data_packets_out, dp.packets_total as data_packets_total, dp.recvfile as data_recvfile, dp.tcpflag as data_tcp_flag, dp."time" as data_time from public.incident i left join ticket_view tv on tv.id=i.ticket_id  left join ticket t on t.id=i.ticket_id left join ticket_state ts on ts.id=t.ticket_state_id left join ticket_state_type tst on ts.state_type=tst.id left join public.ticket_code tc on tc.ticket_id = tv.id left join public.subject_view sv on sv.id = i.subject_id left join public.object_view ov on ov.id = i.object_id left join public.asset asrc on asrc.id = i.source_id left join public.asset adn on adn.id = i.destination_id left join public.asset aes on aes.id = i.event_source left join public.asset acl on acl.id = i.collectorlocationhost_id left join public.datapayload dp on dp.id = i.data left join public.organizations org on org.short_name = i.organization_id left join public.interactiondescription iad on iad.id = i.interaction left join public.natinfo ni on ni.id = i.nat_id left join group_vendor as gv on gv.id=i.vendor_id left join vendors as ven on ven.id=gv.vendor_id   
- changeSet:
      id: 1.0.0/26
      author: aksenova
      changes:
        - createTable:
            tableName: device_categories
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    unique: false                    
        - createTable:
            tableName: device_sub_categories
            columns:
              - column:
                  name: id
                  type: serial
                  constraints:
                    primaryKey: true
                    nullable: true
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    unique: false
- changeSet:
      id: 1.0.0/27
      author: aksenova
      changes:                    
        sql: ALTER TABLE public.group_vendor RENAME TO vendor_solutions; ALTER TABLE public.vendor_solutions ADD category_id int4 NULL; ALTER TABLE public.vendor_solutions ADD sub_category_id int4 NULL; ALTER TABLE public.vendor_solutions ADD CONSTRAINT vendor_solutions_category FOREIGN KEY (category_id) REFERENCES public.device_categories(id); ALTER TABLE public.vendor_solutions ADD CONSTRAINT vendor_solutions_sub_category FOREIGN KEY (sub_category_id) REFERENCES public.device_sub_categories(id);
- changeSet:
      id: 1.0.0/28
      author: aksenova
      changes:  
        sql: ALTER TABLE public.incident ADD source_port varchar NULL; ALTER TABLE public.incident ADD destination_port varchar NULL;
- changeSet:
      id: 1.0.0/29
      author: aksenova
      changes:  
        sql: ALTER TABLE public.incident ALTER COLUMN destination_port TYPE int8 USING destination_port::int8; ALTER TABLE public.incident ALTER COLUMN source_port TYPE int8 USING source_port::int8;
- changeSet:
      id: 1.0.0/30
      author: aksenova
      changes:
        -  delete:  
            tableName:  counterpart  
            where:  counter_name='MalwareObject'
- changeSet:
      id: 1.0.0/31
      author: aksenova
      changes:
        -  insert: 
            tableName: counterpart 
            columns:                
            - column:
                name: id
                value: 9
            - column:
                name: counter_name
                value: malwareObject
            - column:
                name: description
                value: MalwareObject
- changeSet:
      id: 1.0.0/32
      author: aksenova
      changes: 
        sql: DROP VIEW public.full_incidents_view CASCADE;
- changeSet:
      id: 1.0.0/33
      author: aksenova
      changes:
        sql: CREATE OR REPLACE VIEW public.full_incidents_view AS select i.inc_id as incident_id, i.collectorlocationhost_id as incident_collector_location_host_id, i.data as incident_data, i.destination_id as incident_destination_id, i.detect_time as incident_detect_time, i.event_source as incident_event_source, i.event_time as incident_event_time, i.eventsourcecategory_id as incident_event_source_category, i."inputId" as incident_input_id, i.interaction as incident_interaction, i.nat_id as incident_nat_id, i.object_id as incident_object_id, i.organization_id as incident_organization_id, org."name" as incident_organization_full_name, i.rule_id as incident_rule_id, i.severity_level_id as incident_severity_level_id, i.source_id as incident_source_id, i.subject_id as incident_subject_id, i.ticket_id as incident_otrs_id, i.usecase_id as incident_usecase_id, i.subsys, iad.action as interaction_action, i.destination_port as incident_destination_port, i.source_port as incident_sourse_port, iad.direction as interaction_direction, iad.duration as interaction_duration, iad.logon_type as interaction_logon_type, iad.protocol as interaction_protocol, iad.reason as interaction_reason, iad.starttime as interaction_start_time, iad.status as interaction_status, ni.hostname as incident_nat_hostname, ni.ip as incident_nat_ip, ni.port as incident_nat_port, ven.vendor_name as incident_vendor, gv.title as incident_vendor_product, tv.id as ticket_id, tv.action_performed as ticket_action_performed, tv.change_time as ticket_change_time, tv.complexity as ticket_complexity, tv.create_time as ticket_create_time, tv.time_spent as ticket_time_spent, tv.number as ticket_number, tv.state as ticket_state, tst."name" as ticket_state_type, sv.category as subject_category, sv.domain as subject_domain, sv.group as subject_group, sv."name" as subject_name, sv."path" as subject_path, sv.privileges as subject_privileges, sv.version as subject_version, ov.category as object_category, ov.domain as object_domain, ov.group as object_group, ov."name" as object_name, ov."path" as object_path, ov.property as object_property, ov.state as object_state, ov.value as object_value, ov.vendor as object_vendor, ov.version as object_version, asrc.first_seen as source_first_seen, asrc.fqdn as source_fqdn, asrc.hostdomain as source_hostdomain, asrc.hostname as source_hostname, asrc.ip as source_ip, asrc.itop_id as source_id, asrc.last_seen as source_last_seen, asrc.mac as source_mac, asrc.org_id as source_org_id, asrc.server_criticality as source_server_criticality, asrc.server_status as source_server_status, adn.first_seen as destination_first_seen, adn.fqdn as destination_fqdn, adn.hostdomain as destination_hostdomain, adn.hostname as destination_hostname, adn.ip as destination_ip, adn.itop_id as destination_itop_id, adn.last_seen as destination_last_seen, adn.mac as destination_mac, adn.org_id as destination_org_id, adn.server_criticality as destination_server_criticality, adn.server_status as destination_server_status, aes.first_seen as event_source_first_seen, aes.fqdn as event_source_fqdn, aes.hostdomain as event_source_hostdomain, aes.hostname as event_source_hostname, aes.ip as event_source_ip, aes.itop_id as event_source_itop_id, aes.last_seen as event_source_last_seen, aes.mac as event_source_mac, aes.org_id as event_source_org_id, aes.server_criticality as event_source_server_criticality, aes.server_status as event_source_server_status, acl.first_seen as collector_location_first_seen, acl.fqdn as collector_location_fqdn, acl.hostdomain as collector_location_hostdomain, acl.hostname as collector_location_hostname, acl.ip as collector_location_ip, acl.itop_id as collector_location_itop_id, acl.last_seen as collector_location_last_seen, acl.mac as collector_location_mac, acl.org_id as collector_location_org_id, acl.server_criticality as collector_location_server_criticality, acl.server_status as collector_location_server_status, dp.aux1 as data_aux1, dp.aux2 as data_aux2, dp.aux3 as data_aux3, dp.aux4 as data_aux4, dp.aux5 as data_aux5, dp.aux6 as data_aux6, dp.aux7 as data_aux7, dp.aux8 as data_aux8, dp.aux9 as data_aux9, dp.aux10 as data_aux10, dp.bytes_in as data_bytes_in, dp.bytes_out as data_bytes_out, dp.bytes_total as data_bytes_total, dp.interface as data_interface, dp.msgid as data_msgid, dp.origintime as data_origintime, dp.packets_in as data_packets_in, dp.packets_out as data_packets_out, dp.packets_total as data_packets_total, dp.recvfile as data_recvfile, dp.tcpflag as data_tcp_flag, dp."time" as data_time from public.incident i left join ticket_view tv on tv.id=i.ticket_id  left join ticket t on t.id=i.ticket_id left join ticket_state ts on ts.id=t.ticket_state_id left join ticket_state_type tst on ts.state_type=tst.id left join public.ticket_code tc on tc.ticket_id = tv.id left join public.subject_view sv on sv.id = i.subject_id left join public.object_view ov on ov.id = i.object_id left join public.asset asrc on asrc.id = i.source_id left join public.asset adn on adn.id = i.destination_id left join public.asset aes on aes.id = i.event_source left join public.asset acl on acl.id = i.collectorlocationhost_id left join public.datapayload dp on dp.id = i.data left join public.organizations org on org.short_name = i.organization_id left join public.interactiondescription iad on iad.id = i.interaction left join public.natinfo ni on ni.id = i.nat_id left join vendor_solutions as gv on gv.id=i.vendor_id left join vendors as ven on ven.id=gv.vendor_id;   
- changeSet:
      id: 1.0.0/34
      author: aksenova
      changes:        
        sql: CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_data, f.incident_detect_time, f.incident_event_source_category, f.incident_event_time, f.incident_usecase_id,  u.description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, f.subject_category, f.subject_domain, f.subject_group, f.subject_name, f.subject_path, f.subject_privileges, f.subject_version,    cntr1.counter_name AS subject_counter_name, f.object_category, f.object_domain, f.object_group, f.object_name, f.object_path, f.object_property, f.object_state, f.object_value, f.object_vendor, f.object_version,    cntr2.counter_name AS object_counter_name, f.source_fqdn, f.source_hostdomain, f.source_hostname, f.source_ip, f.source_last_seen, f.source_mac, f.source_server_criticality, f.source_server_status, f.destination_first_seen, f.destination_fqdn, f.destination_hostdomain, f.destination_hostname, f.destination_ip, f.destination_last_seen, f.destination_mac, f.destination_server_criticality, f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain, f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, f.ticket_change_time, f.ticket_complexity, f.ticket_create_time, f.ticket_number, f.ticket_state,    l.locale AS language    FROM full_incidents_view f     JOIN usecase u ON f.incident_usecase_id= u.usecase_id   LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN counterpart cntr1 ON cntr1.id = f.subject_category LEFT JOIN counterpart cntr2 ON cntr2.id = f.object_category
- changeSet:
      id: 1.0.0/35
      author: aksenova
      changes:        
        sql: Update incident set vendor_id = NULL
- changeSet:
      id: 1.0.0/36
      author: aksenova
      changes:        
        sql: TRUNCATE TABLE  vendors cascade ; TRUNCATE TABLE  vendor_solutions cascade;       
- changeSet:
      id: 1.0.0/37
      author: aksenova
      changes: 
        sql: DROP VIEW public.translated_incidents_view CASCADE;
- changeSet:
      id: 1.0.0/38
      author: aksenova
      changes:        
        sql: CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_detect_time,    f.incident_event_time,    f.incident_organization_id,    f.incident_organization_full_name,    f.interaction_reason,    f.interaction_logon_type,    ias.description AS interaction_status,    sl.level_name AS incident_importance_level_name,    iac.category_name AS interaction_category_name,    iac.description AS interaction_description,    f.incident_usecase_id,    u.description AS incident_usecase_description,    uc.category AS incident_usecase_category,    uc.subcategory AS incident_usecase_subcategory,    f.incident_nat_hostname,    f.incident_nat_ip,    f.incident_nat_port,    f.incident_vendor,    f.incident_vendor_product,    f.ticket_change_time,    f.ticket_complexity,    f.ticket_create_time,    f.ticket_number,    f.ticket_state,    f.ticket_action_performed,    f.ticket_time_spent,    f.ticket_state_type,    f.subject_category,    f.subject_domain,    f.subject_group,    f.subject_name,    f.subject_path,    f.subject_privileges,    f.subject_version,    f.object_category,    f.object_domain,    f.object_group,    f.object_name,    f.object_path,    f.object_property,    f.object_state,    f.object_value,    f.object_vendor,    f.object_version,    f.source_first_seen,    f.source_fqdn,    f.source_hostdomain,    f.source_hostname,    f.source_ip,    f.source_last_seen,    f.source_mac,    f.source_server_criticality,    f.source_server_status,    f.destination_first_seen,    f.destination_fqdn,    f.destination_hostdomain,    f.destination_hostname,    f.destination_ip,    f.destination_last_seen,    f.destination_mac,    f.destination_server_criticality,    f.destination_server_status,    f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain,  f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, l.locale FROM full_incidents_view f LEFT JOIN usecase u ON f.incident_usecase_id::text = u.usecase_id::text LEFT JOIN usecase_category uc ON uc.id = u.id LEFT JOIN interactionstatus ias ON ias.id = f.interaction_status LEFT JOIN interactioncategory iac ON iac.id = f.interaction_action  LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN severitylevel sl ON sl.id = f.incident_severity_level_id  LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category;        
- changeSet:
      id: 1.0.0/39
      author: kurganov
      changes:
          - dropForeignKeyConstraint:
              baseTableSchemaName:  public
              baseTableName: article
              constraintName: create_fk
          - dropForeignKeyConstraint:
              baseTableSchemaName:  public
              baseTableName: article
              constraintName: change_fk
          - dropForeignKeyConstraint:
              baseTableSchemaName:  public
              baseTableName: article_data_mime
              constraintName: create_fk
          - dropForeignKeyConstraint:
              baseTableSchemaName:  public
              baseTableName: article_data_mime
              constraintName: change_fk
          -  addForeignKeyConstraint:  
              baseColumnNames:  create_by  
              baseTableName:  article  
              baseTableSchemaName:  public  
              constraintName:  create_fk  
              referencedColumnNames:  otrs_id  
              referencedTableName:  users  
              referencedTableSchemaName:  public  
          -  addForeignKeyConstraint:  
              baseColumnNames:  change_by  
              baseTableName:  article  
              baseTableSchemaName:  public  
              constraintName:  change_fk  
              referencedColumnNames:  otrs_id  
              referencedTableName:  users  
              referencedTableSchemaName:  public 
          -  addForeignKeyConstraint:  
              baseColumnNames:  create_by  
              baseTableName:  article_data_mime  
              baseTableSchemaName:  public  
              constraintName:  create_fk  
              referencedColumnNames:  otrs_id  
              referencedTableName:  users  
              referencedTableSchemaName:  public  
          -  addForeignKeyConstraint:  
              baseColumnNames:  change_by  
              baseTableName:  article_data_mime  
              baseTableSchemaName:  public  
              constraintName:  change_fk  
              referencedColumnNames:  otrs_id  
              referencedTableName:  users  
              referencedTableSchemaName:  public 

- changeSet:
      id: 1.0.0/40
      author: aksenova
      changes: 
        sql: DROP VIEW public.translated_incidents_view CASCADE;
- changeSet:
      id: 1.0.0/41
      author: aksenova
      changes:        
        sql: CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_detect_time,    f.incident_event_time,    f.incident_organization_id,    f.incident_organization_full_name,    f.interaction_reason,    f.interaction_logon_type,    ias.description AS interaction_status,    sl.level_name AS incident_importance_level_name,    iac.category_name AS interaction_category_name,    iac.description AS interaction_description,    f.incident_usecase_id,    u.description AS incident_usecase_description,    uc.category AS incident_usecase_category,    uc.subcategory AS incident_usecase_subcategory,    f.incident_nat_hostname,    f.incident_nat_ip,    f.incident_nat_port, f.incident_destination_port,  f.incident_sourse_port,   f.incident_vendor,    f.incident_vendor_product,    f.ticket_change_time,    f.ticket_complexity,    f.ticket_create_time,    f.ticket_number,    f.ticket_state,    f.ticket_action_performed,    f.ticket_time_spent,    f.ticket_state_type,    f.subject_category,    f.subject_domain,    f.subject_group,    f.subject_name,    f.subject_path,    f.subject_privileges,    f.subject_version,     f.object_category,    f.object_domain,    f.object_group,    f.object_name,    f.object_path,    f.object_property,    f.object_state,    f.object_value,    f.object_vendor,    f.object_version,    f.source_first_seen,    f.source_fqdn,    f.source_hostdomain,    f.source_hostname,    f.source_ip,    f.source_last_seen,    f.source_mac,    f.source_server_criticality,    f.source_server_status,    f.destination_first_seen,    f.destination_fqdn,    f.destination_hostdomain,    f.destination_hostname,    f.destination_ip,    f.destination_last_seen,    f.destination_mac,    f.destination_server_criticality,    f.destination_server_status,    f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain,  f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, l.locale FROM full_incidents_view f LEFT JOIN usecase u ON f.incident_usecase_id::text = u.usecase_id::text LEFT JOIN usecase_category uc ON uc.id = u.id LEFT JOIN interactionstatus ias ON ias.id = f.interaction_status LEFT JOIN interactioncategory iac ON iac.id = f.interaction_action  LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN severitylevel sl ON sl.id = f.incident_severity_level_id  LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category;        
- changeSet:
      id: 1.0.0/42
      author: aksenova
      changes:        
        sql: DROP VIEW public.full_incidents_view CASCADE; ALTER TABLE public.natinfo ALTER COLUMN port TYPE int4 USING port::int4;
- changeSet:
      id: 1.0.0/43
      author: aksenova
      changes:
        sql: CREATE OR REPLACE VIEW public.full_incidents_view AS select i.inc_id as incident_id, i.collectorlocationhost_id as incident_collector_location_host_id, i.data as incident_data, i.destination_id as incident_destination_id, i.detect_time as incident_detect_time, i.event_source as incident_event_source, i.event_time as incident_event_time, i.eventsourcecategory_id as incident_event_source_category, i."inputId" as incident_input_id, i.interaction as incident_interaction, i.nat_id as incident_nat_id, i.object_id as incident_object_id, i.organization_id as incident_organization_id, org."name" as incident_organization_full_name, i.rule_id as incident_rule_id, i.severity_level_id as incident_severity_level_id, i.source_id as incident_source_id, i.subject_id as incident_subject_id, i.ticket_id as incident_otrs_id, i.usecase_id as incident_usecase_id, i.subsys, iad.action as interaction_action, i.destination_port as incident_destination_port, i.source_port as incident_sourse_port, iad.direction as interaction_direction, iad.duration as interaction_duration, iad.logon_type as interaction_logon_type, iad.protocol as interaction_protocol, iad.reason as interaction_reason, iad.starttime as interaction_start_time, iad.status as interaction_status, ni.hostname as incident_nat_hostname, ni.ip as incident_nat_ip, ni.port as incident_nat_port, ven.vendor_name as incident_vendor, gv.title as incident_vendor_product, tv.id as ticket_id, tv.action_performed as ticket_action_performed, tv.change_time as ticket_change_time, tv.complexity as ticket_complexity, tv.create_time as ticket_create_time, tv.time_spent as ticket_time_spent, tv.number as ticket_number, tv.state as ticket_state, tst."name" as ticket_state_type, sv.category as subject_category, sv.domain as subject_domain, sv.group as subject_group, sv."name" as subject_name, sv."path" as subject_path, sv.privileges as subject_privileges, sv.version as subject_version, ov.category as object_category, ov.domain as object_domain, ov.group as object_group, ov."name" as object_name, ov."path" as object_path, ov.property as object_property, ov.state as object_state, ov.value as object_value, ov.vendor as object_vendor, ov.version as object_version, asrc.first_seen as source_first_seen, asrc.fqdn as source_fqdn, asrc.hostdomain as source_hostdomain, asrc.hostname as source_hostname, asrc.ip as source_ip, asrc.itop_id as source_id, asrc.last_seen as source_last_seen, asrc.mac as source_mac, asrc.org_id as source_org_id, asrc.server_criticality as source_server_criticality, asrc.server_status as source_server_status, adn.first_seen as destination_first_seen, adn.fqdn as destination_fqdn, adn.hostdomain as destination_hostdomain, adn.hostname as destination_hostname, adn.ip as destination_ip, adn.itop_id as destination_itop_id, adn.last_seen as destination_last_seen, adn.mac as destination_mac, adn.org_id as destination_org_id, adn.server_criticality as destination_server_criticality, adn.server_status as destination_server_status, aes.first_seen as event_source_first_seen, aes.fqdn as event_source_fqdn, aes.hostdomain as event_source_hostdomain, aes.hostname as event_source_hostname, aes.ip as event_source_ip, aes.itop_id as event_source_itop_id, aes.last_seen as event_source_last_seen, aes.mac as event_source_mac, aes.org_id as event_source_org_id, aes.server_criticality as event_source_server_criticality, aes.server_status as event_source_server_status, acl.first_seen as collector_location_first_seen, acl.fqdn as collector_location_fqdn, acl.hostdomain as collector_location_hostdomain, acl.hostname as collector_location_hostname, acl.ip as collector_location_ip, acl.itop_id as collector_location_itop_id, acl.last_seen as collector_location_last_seen, acl.mac as collector_location_mac, acl.org_id as collector_location_org_id, acl.server_criticality as collector_location_server_criticality, acl.server_status as collector_location_server_status, dp.aux1 as data_aux1, dp.aux2 as data_aux2, dp.aux3 as data_aux3, dp.aux4 as data_aux4, dp.aux5 as data_aux5, dp.aux6 as data_aux6, dp.aux7 as data_aux7, dp.aux8 as data_aux8, dp.aux9 as data_aux9, dp.aux10 as data_aux10, dp.bytes_in as data_bytes_in, dp.bytes_out as data_bytes_out, dp.bytes_total as data_bytes_total, dp.interface as data_interface, dp.msgid as data_msgid, dp.origintime as data_origintime, dp.packets_in as data_packets_in, dp.packets_out as data_packets_out, dp.packets_total as data_packets_total, dp.recvfile as data_recvfile, dp.tcpflag as data_tcp_flag, dp."time" as data_time from public.incident i left join ticket_view tv on tv.id=i.ticket_id  left join ticket t on t.id=i.ticket_id left join ticket_state ts on ts.id=t.ticket_state_id left join ticket_state_type tst on ts.state_type=tst.id left join public.ticket_code tc on tc.ticket_id = tv.id left join public.subject_view sv on sv.id = i.subject_id left join public.object_view ov on ov.id = i.object_id left join public.asset asrc on asrc.id = i.source_id left join public.asset adn on adn.id = i.destination_id left join public.asset aes on aes.id = i.event_source left join public.asset acl on acl.id = i.collectorlocationhost_id left join public.datapayload dp on dp.id = i.data left join public.organizations org on org.short_name = i.organization_id left join public.interactiondescription iad on iad.id = i.interaction left join public.natinfo ni on ni.id = i.nat_id left join vendor_solutions as gv on gv.id=i.vendor_id left join vendors as ven on ven.id=gv.vendor_id; CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_detect_time,    f.incident_event_time,    f.incident_organization_id,    f.incident_organization_full_name,    f.interaction_reason,    f.interaction_logon_type,    ias.description AS interaction_status,    sl.level_name AS incident_importance_level_name,    iac.category_name AS interaction_category_name,    iac.description AS interaction_description,    f.incident_usecase_id,    u.description AS incident_usecase_description,    uc.category AS incident_usecase_category,    uc.subcategory AS incident_usecase_subcategory,    f.incident_nat_hostname,    f.incident_nat_ip,    f.incident_nat_port, f.incident_destination_port,  f.incident_sourse_port,   f.incident_vendor,    f.incident_vendor_product,    f.ticket_change_time,    f.ticket_complexity,    f.ticket_create_time,    f.ticket_number,    f.ticket_state,    f.ticket_action_performed,    f.ticket_time_spent,    f.ticket_state_type,    f.subject_category,    f.subject_domain,    f.subject_group,    f.subject_name,    f.subject_path,    f.subject_privileges,    f.subject_version,     f.object_category,    f.object_domain,    f.object_group,    f.object_name,    f.object_path,    f.object_property,    f.object_state,    f.object_value,    f.object_vendor,    f.object_version,    f.source_first_seen,    f.source_fqdn,    f.source_hostdomain,    f.source_hostname,    f.source_ip,    f.source_last_seen,    f.source_mac,    f.source_server_criticality,    f.source_server_status,    f.destination_first_seen,    f.destination_fqdn,    f.destination_hostdomain,    f.destination_hostname,    f.destination_ip,    f.destination_last_seen,    f.destination_mac,    f.destination_server_criticality,    f.destination_server_status,    f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain,  f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, l.locale FROM full_incidents_view f LEFT JOIN usecase u ON f.incident_usecase_id::text = u.usecase_id::text LEFT JOIN usecase_category uc ON uc.id = u.id LEFT JOIN interactionstatus ias ON ias.id = f.interaction_status LEFT JOIN interactioncategory iac ON iac.id = f.interaction_action  LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN severitylevel sl ON sl.id = f.incident_severity_level_id  LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category;        
- changeSet:
      id: 1.0.0/44
      author: aksenova
      changes:
        sql:  DROP TABLE public.usecase_category CASCADE; CREATE TABLE public.categories (id serial NOT NULL, category_id varchar NOT NULL, lang_id varchar(3) NOT NULL,description varchar NOT NULL, CONSTRAINT categories_pkey PRIMARY KEY (id));
- changeSet:
      id: 1.0.0/45
      author: aksenova
      changes:
        sql: ALTER TABLE public.usecase ADD CONSTRAINT usecase_fk FOREIGN KEY (category_id) REFERENCES public.categories(id);
- changeSet:
      id: 1.0.0/46
      author: aksenova
      changes:
        sql: ALTER TABLE public.usecase DROP CONSTRAINT usecase_fk; ALTER TABLE public.usecase ALTER COLUMN category_id TYPE varchar USING category_id::varchar; 
- changeSet:
      id: 1.0.0/47
      author: aksenova
      changes:
        sql: DROP TABLE public.interactionstatus CASCADE;
- changeSet:
      id: 1.0.0/48
      author: aksenova
      changes:
        - createTable:
            tableName: interactionstatus
            columns:
              - column:
                  name: id
                  type: int4
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: status_name
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: description
                  type: varchar
                  constraints:
                    nullable: True
                    unique: false
              - column:
                  name: lang_id
                  type: int
                  constraints:
                    nullable: True
                    unique: false    
- changeSet:
      id: 1.0.0/49
      author: aksenova
      changes:              
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: status_name
                value: failure
            - column:
                name: description
                value: Неуспешная попытка
            - column:
                name: lang_id
                value: 1   
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: status_name
                value: success
            - column:
                name: description
                value: Успешная попытка
            - column:
                name: lang_id
                value: 1                  
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: status_name
                value: ongoing
            - column:
                name: description
                value: Действие происходит в данный момент
            - column:
                name: lang_id
                value: 1  
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 1
            - column:
                name: status_name
                value: failure
            - column:
                name: description
                value: Unsuccessful attempt
            - column:
                name: lang_id
                value: 2  
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 2
            - column:
                name: status_name
                value: success
            - column:
                name: description
                value: Successful attempt
            - column:
                name: lang_id
                value: 2                 
        -  insert: 
            tableName: interactionstatus 
            columns:                
            - column:
                name: id
                value: 3
            - column:
                name: status_name
                value: ongoing
            - column:
                name: description
                value: The action is taking place at the moment
            - column:
                name: lang_id
                value: 2
- changeSet:
      id: 1.0.0/50
      author: aksenova
      changes:
        sql: ALTER TABLE public.entity DROP CONSTRAINT objects; ALTER TABLE public.entity DROP CONSTRAINT subjects; ALTER TABLE public.counterpart DROP CONSTRAINT counterpart_pkey; TRUNCATE TABLE counterpart; ALTER TABLE public.counterpart ADD lang_id int4 null; ALTER TABLE public.counterpart ADD CONSTRAINT counterpart_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id);  ALTER TABLE public.interactionstatus ADD CONSTRAINT interactionstatus_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); ALTER TABLE public.counterpart DROP CONSTRAINT counterpart_counter_name_key;
- changeSet:
      id: 1.0.0/51
      author: aksenova
      changes:
        sql:   insert into counterpart values  ('1 ', 'account ', 'Пользователь ', '1 '), ('1 ', 'account ', 'User ', '2 '), ('2 ', 'application ', 'Приложение ', '1 '), ('2 ', 'application ', 'Application ', '2 '), ('3 ', 'host ', 'Узел ', '1 '), ('3 ', 'host ', 'Host ', '2 '), ('4 ', 'process ', 'Процесс ', '1 '), ('4 ', 'process ', 'Process ', '2 '), ('5 ', 'rule ', 'Правило ', '1 '), ('5 ', 'rule ', 'Rule ', '2 '), ('6 ', 'system ', 'Система ', '1 '), ('6 ', 'system ', 'System ', '2 '), ('7 ', 'file ', 'Файл ', '1 '), ('7 ', 'file ', 'File ', '2 '), ('8 ', 'url ', 'URL ', '1 '), ('8 ', 'url ', 'URL ', '2 '), ('9 ', 'malwareObject ', 'Вредоносный объект ', '1 '), ('9 ', 'malwareObject ', 'Malware Object ', '2 '), ('10 ', 'mailAttachment ', 'Почтовое вложение ', '1 '), ('10 ', 'mailAttachment ', 'Mail Attachment ', '2 '), ('11 ', 'userGroup ', 'Группа пользователей ', '1 '), ('11 ', 'userGroup ', 'User Group ', '2 '), ('13 ', 'connection ', 'Соединение ', '1 '), ('13 ', 'connection ', 'Connection ', '2 '), ('14 ', 'interface ', 'Интерфейс ', '1 '), ('14 ', 'interface ', 'Interface ', '2 ')
- changeSet:
      id: 1.0.0/52
      author: aksenova
      changes:
        sql: DROP VIEW IF EXISTS public.translated_incidents_view CASCADE; CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_detect_time, f.incident_event_time,   f.incident_organization_id,  f.incident_organization_full_name,  f.interaction_reason,  f.interaction_logon_type,  ias.description AS interaction_status,   sl.level_name AS incident_importance_level_name,  iac.category_name AS interaction_category_name,  iac.description AS interaction_description,  f.incident_usecase_id,  u.description AS incident_usecase_description,  uc.category_id AS incident_usecase_category,   f.incident_nat_hostname,  f.incident_nat_ip, f.incident_nat_port, f.incident_destination_port, f.incident_sourse_port, f.incident_vendor,  f.incident_vendor_product, f.ticket_change_time, f.ticket_complexity,   f.ticket_create_time,   f.ticket_number,   f.ticket_state,  f.ticket_action_performed, f.ticket_time_spent,   f.ticket_state_type,  f.subject_category,  f.subject_domain, f.subject_group, f.subject_name,   f.subject_path,  f.subject_privileges,  f.subject_version,   f.object_category,   f.object_domain,   f.object_group,   f.object_name,  f.object_path,  f.object_property,  f.object_state,  f.object_value,  f.object_vendor,  f.object_version,  f.source_first_seen,  f.source_fqdn,   f.source_hostdomain, f.source_hostname,  f.source_ip,   f.source_last_seen, f.source_mac,  f.source_server_criticality, f.source_server_status,   f.destination_first_seen,  f.destination_fqdn,   f.destination_hostdomain, f.destination_hostname,  f.destination_ip,  f.destination_last_seen, f.destination_mac,   f.destination_server_criticality, f.destination_server_status,  f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain, f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality,f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip,f.collector_location_last_seen,f.collector_location_mac, f.collector_location_server_criticality,f.collector_location_server_status,f.data_aux1, f.data_aux2,f.data_aux3, f.data_aux4,f.data_aux5, f.data_aux6,f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in,f.data_packets_out,f.data_packets_total,f.data_recvfile,f.data_tcp_flag,f.data_time, l.locale FROM full_incidents_view f left  JOIN interactionstatus ias ON ias.id = f.interaction_status left join languages l on ias.lang_id=l.id left join usecase u ON f.incident_usecase_id::text = u.usecase_id::text and u.lang_id = l.id LEFT JOIN categories uc ON uc.category_id = u.category_id LEFT JOIN interactioncategory iac ON iac.id = f.interaction_action LEFT JOIN severitylevel sl ON sl.id = f.incident_severity_level_id LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category
- changeSet:
      id: postMigration
      author: kurganov
      runAlways: true
      changes:
         sql: GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO dwh_admins;GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO dwh_admins;GRANT SELECT  ON ALL TABLES IN SCHEMA public TO dwh_users;GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO dwh_users;
- changeSet:
      id: 1.0.0/53
      author: aksenova
      changes:
        sql:  CREATE TABLE counterpart_translate(cnt_name varchar NULL, cnt_descr varchar NULL, lang_id int4 null); insert into counterpart_translate values ('account', 'Пользователь', '1'), ('account', 'User', '2'), ('application', 'Приложение', '1'), ('application', 'Application', '2'), ('host', 'Узел', '1'), ('host', 'Host ', '2'), ('process', 'Процесс', '1'),('process', 'Process', '2') , ('rule', 'Правило', '1'), ('rule', 'Rule', '2') , ('system', 'Система', '1'), ('system', 'System', '2'), ('file', 'Файл', '1'), ('file', 'File', '2'), ('url', 'URL', '1'), ('url', 'URL', '2'), ('malwareObject', 'Вредоносный объект', '1'), ('malwareObject', 'Malware Object', '2'), ('mailAttachment', 'Почтовое вложение', '1'), ('mailAttachment', 'Mail Attachment', '2'), ('userGroup', 'Группа пользователей', '1'), ('userGroup', 'User Group', '2'), ('command', 'Команда', '1'), ('command', 'Сommand', '2'), ('connection', 'Соединение', '1'), ('connection', 'Connection', '2'),('interface', 'Интерфейс', '1'), ('interface', 'Interface', '2');ALTER TABLE public.counterpart_translate ADD CONSTRAINT counterpart_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); truncate table counterpart; ALTER TABLE public.counterpart DROP COLUMN lang_id cascade; ALTER TABLE public.counterpart DROP COLUMN description; ALTER TABLE public.counterpart ADD counter_translate_id varchar NULL; insert into counterpart values ('1', 'account', 'account'),('2', 'application', 'application'),('3', 'host', 'host'),('4', 'process', 'process'),('5', 'rule', 'rule'),('6', 'system', 'system'),('7', 'file', 'file'),('8', 'url', 'url'),('9', 'malwareObject', 'malwareObject'),('10', 'mailAttachment', 'mailAttachment'),('11', 'userGroup', 'userGroup'),('12', 'command', 'command'),('13', 'connection', 'connection'),('14', 'interface', 'interface'); ALTER TABLE public.counterpart ADD CONSTRAINT counterpart_pk PRIMARY KEY (id); ALTER TABLE public.entity ADD CONSTRAINT cnt_obj FOREIGN KEY (counterpart_object_id) REFERENCES public.counterpart(id); ALTER TABLE public.entity ADD CONSTRAINT cnt_subj FOREIGN KEY (counterpart_subject_id) REFERENCES public.counterpart(id); CREATE TABLE interactionstatus_translate(status_name   varchar NULL, status_descr varchar NULL, lang_id int4 null); insert into interactionstatus_translate values ('failure', 'Неуспешная попытка', '1'), ('success', 'Успешная попытка', '1'), ('ongoing', 'Действие происходит в данный момент', '1'), ('failure', 'Unsuccessful attempt', '2'), ('success', 'Successful attempt', '2'), ('ongoing', 'The action is taking place at the moment', '2'); ALTER TABLE public.interactionstatus_translate ADD CONSTRAINT interactionstatus_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); truncate table interactionstatus;  ALTER TABLE public.interactionstatus DROP COLUMN lang_id cascade; ALTER TABLE public.interactionstatus DROP COLUMN description;  ALTER TABLE public.interactionstatus ADD status_translate_id varchar NULL; ALTER TABLE public.interactionstatus ADD CONSTRAINT interactionstatus_pk PRIMARY KEY (id); insert into interactionstatus values ('1', 'failure', 'failure'), ('2', 'success', 'success'), ('3', 'ongoing', 'ongoing'); ALTER TABLE public.interactiondescription ADD CONSTRAINT status FOREIGN KEY (status) REFERENCES public.interactionstatus(id); ALTER TABLE public.ticket_history ADD ticket_history_identity_hash varchar NULL;     
- changeSet:
      id: 1.0.0/54
      author: aksenova
      changes:
        sql:   DROP VIEW IF EXISTS public.translated_incidents_view CASCADE; CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_detect_time, f.incident_event_time,   f.incident_organization_id,  f.incident_organization_full_name,  f.interaction_reason,  f.interaction_logon_type,  iast.status_descr AS interaction_status,   sl.level_name AS incident_importance_level_name,  iac.category_name AS interaction_category_name,  iac.description AS interaction_description,  f.incident_usecase_id,  u.description AS incident_usecase_description,  uc.category_id AS incident_usecase_category,   f.incident_nat_hostname,  f.incident_nat_ip, f.incident_nat_port, f.incident_destination_port, f.incident_sourse_port, f.incident_vendor,  f.incident_vendor_product, f.ticket_change_time, f.ticket_complexity,   f.ticket_create_time,   f.ticket_number,   f.ticket_state,  f.ticket_action_performed, f.ticket_time_spent,   f.ticket_state_type,  f.subject_category,  f.subject_domain, f.subject_group, f.subject_name,   f.subject_path,  f.subject_privileges,  f.subject_version,   f.object_category,   f.object_domain,   f.object_group,   f.object_name,  f.object_path,  f.object_property,  f.object_state,  f.object_value,  f.object_vendor,  f.object_version,  f.source_first_seen,  f.source_fqdn,   f.source_hostdomain, f.source_hostname,  f.source_ip,   f.source_last_seen, f.source_mac,  f.source_server_criticality, f.source_server_status,   f.destination_first_seen,  f.destination_fqdn,   f.destination_hostdomain, f.destination_hostname,  f.destination_ip,  f.destination_last_seen, f.destination_mac,   f.destination_server_criticality, f.destination_server_status,  f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain, f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality,f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip,f.collector_location_last_seen,f.collector_location_mac, f.collector_location_server_criticality,f.collector_location_server_status,f.data_aux1, f.data_aux2,f.data_aux3, f.data_aux4,f.data_aux5, f.data_aux6,f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in,f.data_packets_out,f.data_packets_total,f.data_recvfile,f.data_tcp_flag,f.data_time, l.locale  FROM full_incidents_view f  left  JOIN interactionstatus ias ON ias.id = f.interaction_status  left join interactionstatus_translate iast on iast.status_name=ias.status_translate_id left join languages l on iast.lang_id=l.id  left join usecase u ON f.incident_usecase_id::text = u.usecase_id::text and u.lang_id = l.id  LEFT JOIN categories uc ON uc.category_id = u.category_id  LEFT JOIN interactioncategory iac ON iac.id = f.interaction_action  LEFT JOIN severitylevel sl ON sl.id = f.incident_severity_level_id LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category        
- changeSet:
      id: 1.0.0/55
      author: aksenova
      changes:
        sql: CREATE TABLE public.device_types ( id serial NOT NULL, dev_type varchar(200) NOT NULL, category_id int4 NOT NULL, sub_category_id int4 NOT NULL, CONSTRAINT device_types_dev_type_key UNIQUE (dev_type), CONSTRAINT device_types_pkey PRIMARY KEY (id), CONSTRAINT fk_dev_types_to_categories FOREIGN KEY (category_id) REFERENCES device_categories(id) ON DELETE RESTRICT, CONSTRAINT fk_dev_types_to_sub_categories FOREIGN KEY (sub_category_id) REFERENCES device_sub_categories(id) ON DELETE RESTRICT );ALTER TABLE public.host_status ADD sub_cat_id int4 NULL; ALTER TABLE public.host_status ADD CONSTRAINT host_status_subcat FOREIGN KEY (sub_cat_id) REFERENCES public.device_sub_categories(id); CREATE TABLE public.flow_metrics ( id serial NOT NULL, dev_type_id varchar null, cnt int4 NULL, org_id varchar not null, host_id int4 not null, time timestamp null, CONSTRAINT flow_metrics_org FOREIGN KEY (org_id) REFERENCES public.organizations(short_name),CONSTRAINT flow_metrics_host FOREIGN KEY (host_id) REFERENCES public.host_status(id)); CREATE TABLE public.timeouts ( id serial NOT NULL, dev_sub_cat int4 null, timeout interval null, CONSTRAINT timuout_fk FOREIGN KEY (dev_sub_cat) REFERENCES public.device_sub_categories(id)); create index hash1 on ticket_history using hash(ticket_history_identity_hash);
- changeSet:
      id: 1.0.0/56
      author: aksenova
      changes:
        sql: ALTER TABLE public.vendor_solutions ADD dev_type varchar NULL; DROP TABLE public.device_types CASCADE; create table incidents_dashboard (ticket_otrs_id int8 not null, ticket_ticket_number varchar not null, ticket_create_time timestamp not null, ticket_change_time timestamp not null, ticket_queue_name varchar not null, ticket_ticket_state_name  varchar not null, ticket_ticket_state_type_name varchar not null, incident_id int4 not null, incident_usecase_id varchar not null, incident_rule_id varchar not null, incident_detect_time timestamp not null, incident_event_time timestamp not null, incident_organization_short_name varchar not null, incident_severitylevel_level_name varchar not null, incident_eventsourcecategory_category_name varchar not null, incident_destination_fqdn varchar null, incident_destination_hostname varchar null, incident_destination_ip varchar null, incident_destination_mac varchar null, incident_destination_first_seen date null, incident_destination_last_seen date null, incident_destination_hostdomain varchar null, incident_destination_server_status varchar null, incident_destination_server_criticality varchar null, incident_source_fqdn varchar null, incident_source_hostname varchar null, incident_source_ip varchar null, incident_source_mac date null, incident_source_first_seen date null, incident_source_last_seen varchar null, incident_source_hostdomain varchar null, incident_source_server_status varchar null, incident_source_server_criticality varchar null, incident_event_source_fqdn varchar null, incident_event_source_hostname varchar null, incident_event_source_ip varchar null, incident_event_source_mac date null, incident_event_source_first_seen date null, incident_event_source_last_seen varchar null, incident_event_source_hostdomain varchar null, incident_event_source_server_status varchar null, incident_event_source_server_criticality varchar null, incident_collectorlocationhost_fqdn varchar null, incident_collectorlocationhost_hostname varchar null, incident_collectorlocationhost_ip varchar null, incident_collectorlocationhost_mac date null, incident_collectorlocationhost_first_seen date null, incident_collectorlocationhost_last_seen varchar null, incident_collectorlocationhost_hostdomain varchar null, incident_collectorlocationhost_server_status varchar null, incident_subject_domain varchar null, incident_subject_group varchar null, incident_subject_counterpart varchar null, incident_subject_name varchar null, incident_subject_version varchar null, incident_subject_property varchar null, incident_subject_state varchar null, incident_subject_value varchar null, incident_subject_vendor varchar null, incident_subject_privileges varchar null, incident_subject_path varchar null, incident_object_domain varchar null, incident_object_group varchar null, incident_object_counterpart varchar null, incident_object_name varchar null, incident_object_version varchar null, incident_object_property varchar null, incident_object_state varchar null, incident_object_value varchar null, incident_object_vendor varchar null, incident_object_privileges varchar null, incident_object_path varchar null, incident_collectorlocationhost_server_criticality varchar null, incident_inc_id varchar not null, incident_inputId varchar not null, incident_raw varchar not null, incident_source_port int4 null, incident_destination_port int4 null, incident_subsys varchar null, incident_identity_hash varchar not null, incident_eventsourcecategory_name varchar null, incident_vendor_name varchar null, incident_vendor_title varchar null, incident_device_category varchar null, incident_device_sub_category varchar null, incident_nat_hostname varchar null, incident_nat_ip varchar null, incident_nat_port int4 null, incident_interactiondescription_direction varchar null, incident_interactiondescription_duration int4 null, incident_interactiondescription_logon_type bytea null, incident_interactiondescription_protocol varchar null, incident_interactiondescription_reason varchar null, incident_interactiondescription_starttime timestamp null, incident_interactionstatus_status_name varchar null, incident_interactionstatus_description varchar null, incident_interactioncategory_category_name varchar null, incident_interactioncategory_description varchar null, incident_datapayload_bytes_total varchar null, incident_datapayload_bytes_in varchar null, incident_datapayload_bytes_out varchar null, incident_datapayload_packets_total varchar null, incident_datapayload_packets_in varchar null, incident_datapayload_packets_out varchar null, incident_datapayload_interface varchar null, incident_datapayload_msgid varchar null, incident_datapayload_origintime timestamp null, incident_datapayload_recvfile varchar null, incident_datapayload_tcpflag varchar null, incident_datapayload_time timestamp null, incident_datapayload_aux1 varchar null, incident_datapayload_aux2 varchar null, incident_datapayload_aux3 varchar null, incident_datapayload_aux4 varchar null, incident_datapayload_aux5 varchar null, incident_datapayload_aux6 varchar null, incident_datapayload_aux7 varchar null, incident_datapayload_aux8 varchar null, incident_datapayload_aux9 varchar null, incident_datapayload_aux10 varchar null);     
- changeSet:
      id: 1.0.0/57
      author: aksenova
      changes:
        sql: ALTER TABLE public.flow_metrics DROP CONSTRAINT flow_metrics_host; ALTER TABLE public.flow_metrics RENAME COLUMN host_id TO host_name; ALTER TABLE public.flow_metrics ALTER COLUMN host_name TYPE varchar USING host_name::varchar; ALTER TABLE public.incident ADD root_id varchar NULL;
- changeSet:
      id: 1.0.0/58
      author: aksenova
      changes:
        sql: UPDATE incident SET severity_level_id = '2' WHERE severity_level_id='1'; DELETE FROM severitylevel s WHERE level_name = 'INFO'; ALTER TABLE public.severitylevel ADD "translate" varchar NULL; create table severitylevel_translate (level_name varchar not null, level_description varchar not null, lang_id int4 not null); ALTER TABLE public.severitylevel_translate ADD CONSTRAINT severitylevel_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); insert into severitylevel_translate values ('LOW','Низкий','1'),('MEDIUM','Средний','1'),('HIGH','Высокий','1'),('LOW','Low','2'),('MEDIUM','Medium','2'),('HIGH','High','2'); UPDATE severitylevel SET "translate" = level_name;
- changeSet:
      id: 1.0.0/59
      author: aksenova
      changes:
        sql: ALTER TABLE public.interactioncategory ADD "translate" varchar NULL; create table interactioncategory_translate (intcategory_name varchar not null, intcategory_description varchar not null, lang_id int4 not null); ALTER TABLE public.interactioncategory_translate ADD CONSTRAINT interactioncategory_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); insert into interactioncategory_translate values ('access','Получение доступа','1'),('alert','Получение предупреждения','1'),('allow','Разрешение','1'),('apply','Применение','1'),('backup','Резервное копирование','1'),('bind','Присвоение IP-адреса, добавление политики в группу','1'),('call','Звонок','1'),('check','Проверка','1'),('clean','Очистка','1'),('close','Закрытие','1'),('configure','Настройка','1'),('connect','Соединение','1'),('copy','Копирование','1'),('create','Создание','1'),('decrypt','Расшифровка','1'),('deliver','Доставка','1'),('deny','Запрет','1'),('detect','Обнаружение','1'),('disable','Выключение','1'),('disconnect','Разъединение','1'),('down','Изменение состояния интерфейса на down (выключение)','1'),('download','Скачивание','1'),('enable','Включение','1'),('encrypt','Зашифровка','1'),('exclude','Исключение','1'),('execute','Выполнение','1'),('extract','Извлечение','1'),('grant','Предоставление права, привилегии','1'),('info','События, носящие информационный характер, без возможности выделить действия','1'),('initiate','Инициирование','1'),('install','Установка','1'),('leak','Утечка данных','1'),('lock','Блокирование','1'),('login','Вход в систему','1'),('logout','Выход из системы','1'),('modify','Изменение','1'),('move','Перемещение','1'),('open','Открывание','1'),('print','Распечатывание','1'),('protect','Защита','1'),('quarantine','Изолирование','1'),('recieve','Принятие','1'),('reject','Отмена','1'),('remove','Удаление','1'),('reset','Сброс к состоянию по умолчанию','1'),('restart','Перезапуск','1'),('restore','Восстановление','1'),('revoke','Отзыв права, привилегии','1'),('rollback','Откат к предыдущему состоянию','1'),('scan','Сканирование','1'),('search','Поиск','1'),('send','Отправка','1'),('start','Запуск','1'),('stop','Остановка','1'),('sync','Синхронизация','1'),('terminate','Завершение','1'),('unbind','Удаление политики из группы, освобождение IP-адреса','1'),('uninstall','Удаление продукта','1'),('unlock','Разблокирование','1'),('up','Изменение состояния интерфейса на up (включение)','1'),('update','Обновление (минорное)','1'),('upgrade','Обновление (мажорное)','1'),('upload','Загрузка','1'),('view','Просмотр','1'),('access','Gaining access','2'),('alert','Receiving a warning','2'),('allow','Resolution','2'),('apply','Application','2'),('backup','Backup','2'),('bind','Assigning an IP address, adding a policy to a group','2'),('call','Call','2'),('check','Check','2'),('clean','Cleaning','2'),('close','Closing','2'),('configure','Configuration','2'),('connect','Connection','2'),('copy','Copying','2'),('create','Creature','2'),('decrypt','Decryption','2'),('deliver','Delivery','2'),('deny','Deny','2'),('detect','Detection','2'),('disable','Shutdown','2'),('disconnect','Disconnection','2'),('down','Changing the state of the interface to down (shutdown)','2'),('download','Download','2'),('enable','Turning on','2'),('encrypt','Encryption','2'),('exclude','An exception','2'),('execute','Performance','2'),('extract','Retrieving','2'),('grant','Granting rights, privileges','2'),('info','Informational events without the ability to highlight actions','2'),('initiate','Initiation','2'),('install','Installation','2'),('leak','Data leak','2'),('lock','Blocking','2'),('login','Login to the system','2'),('logout','Logout','2'),('modify','Change','2'),('move','Moving','2'),('open','Opening','2'),('print','Printing','2'),('protect','Protection','2'),('quarantine','Isolation','2'),('recieve','Adoption','2'),('reject','Cancellation','2'),('remove','Deleting','2'),('reset','Reset to default state','2'),('restart','Restart','2'),('restore','Recovery','2'),('revoke','Revocation of rights, privileges','2'),('rollback','Roll back to a previous state','2'),('scan','Scanning','2'),('search','Search','2'),('send','Sending','2'),('start','Launch','2'),('stop','Stop','2'),('sync','Synchronization','2'),('terminate','Completion','2'),('unbind','Removing a policy from a group, releasing an IP address','2'),('uninstall','Removing a product','2'),('unlock','Unlocking','2'),('up','Change interface state to up (enable)','2'),('update','Update (minor)','2'),('upgrade','Update (major)','2'),('upload','Loading','2'),('view','View','2'); UPDATE interactioncategory SET "translate" = category_name;
- changeSet:
      id: 1.0.0/60
      author: aksenova
      changes:
        sql: ALTER TABLE public.ticket_state_type ADD "translate" varchar NULL; create table state_type_translate (state_type_name varchar not null, state_type_description varchar not null, lang_id int4 not null); insert into state_type_translate values ('new','Новый','1'),('open','Открыт','1'),('closed','Закрыт','1'),('pending reminder','Ожидает ответа от клиента','1'),('pending auto','Ожидает ответа ( автоматически)','1'),('removed','Удален','1'),('merged','Выполнено слияние с другим','1'),('new','New','2'),('open','Open','2'),('closed','Closed','2'),('pending reminder','Pending reminder','2'),('pending auto','Pending auto','2'),('removed','Removed','2'),('merged','Merged','2'); ALTER TABLE public.state_type_translate ADD CONSTRAINT state_type_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id); ALTER TABLE public.ticket_state ADD "translate" varchar NULL; create table type_translate (type_name varchar not null, type_description varchar not null, lang_id int4 not null); insert into type_translate values ('registered','Зарегистрирован','1'),('closed','Закрыт','1'),('rejected','Отклонен','1'),('in progress','Выполнятеся','1'),('removed','Удален','1'),('pending execution','Ожидает исполнения','1'),('executed','Выполнен','1'),('merged','Выполнено слияние с другим','1'),('pending client','Ожидается ответ от клиента','1'),('pending auto close-','Ожидает закрытия ( автоматически) ','1'),('closed with workaround','Закрытс обходным путем','1'),('approved','Одобрен','1'),('pending completion','Ожидает завершения','1'),('В работе','В работе','1'),('Отложенное исполнение','Отложенное исполнение','1'),('task pending dependency','Незавершенная задача','1'),('pending approval','Ожидает поддтверждения','1'),('registered','Registered','2'),('closed','Closed','2'),('rejected','Rejected','2'),('in progress','In progress','2'),('removed','Removed','2'),('pending execution','Pending execution','2'),('executed','Executed','2'),('merged','Merged','2'),('pending client','Pending client','2'),('pending auto close-','Pending auto close','2'),('closed with workaround','Closed with workaround','2'),('approved','Approved','2'),('pending completion','Pending completion','2'),('В работе','Work in progress','2'),('Отложенное исполнение','Deferred execution','2'),('task pending dependency','Task pending dependency','2'),('pending approval','Pending approval','2'); UPDATE ticket_state SET "translate" = "name"; UPDATE ticket_state_type SET "translate" = "name"; ALTER TABLE public.type_translate ADD CONSTRAINT type_translate_fk FOREIGN KEY (lang_id) REFERENCES public.languages(id);
- changeSet:      
      id: 1.0.0/61
      author: aksenova
      changes:
        sql: DROP VIEW public.translated_incidents_view; DROP VIEW public.full_incidents_view; DROP VIEW public.subject_view; DROP VIEW public.object_view; DROP VIEW public.ticket_view; CREATE OR REPLACE VIEW public.sla_view AS SELECT ticket.ticket_id, CASE WHEN ticket.ticket_time_unit >= 0 AND ticket.ticket_time_unit <= 30 THEN 'Simple'::text ELSE CASE WHEN ticket.ticket_time_unit >= 31 AND ticket.ticket_time_unit <= 179 THEN 'Medium'::text ELSE CASE WHEN ticket.ticket_time_unit >= 180 THEN 'Complex'::text ELSE CASE WHEN ticket.ticket_time_unit IS NULL AND ticket.ticket_id IS NOT NULL THEN 'Autoclose'::text ELSE NULL::text END END END END AS complexity, ticket.ticket_time_unit FROM ticket; CREATE OR REPLACE VIEW public.ticket_view AS SELECT main.id AS ticket_id, main.ticket_id AS incident_otrs_id, main.ticket_tn AS ticket_number, main.name AS ticket_state, main.state_type AS ticket_state_type, main.code_name AS ticket_code_name, main.complexity AS ticket_complexity, main.ticket_time_unit AS ticket_time_spent, main.create_time AS ticket_create_time, main.change_time AS ticket_change_time, r.a_body AS ticket_action_performed FROM ( SELECT ticket.id, ticket.ticket_id, ticket.ticket_tn, ticket_state.name, tst.name AS state_type, cc.name AS code_name, sla_view.complexity, sla_view.ticket_time_unit, ticket.create_time, ticket.change_time FROM ticket LEFT JOIN sla_view ON sla_view.ticket_id = ticket.ticket_id LEFT JOIN ticket_state ON ticket.ticket_state_id = ticket_state.id LEFT JOIN ticket_state_type tst ON tst.id = ticket_state.state_type LEFT JOIN ticket_code tc ON tc.ticket_id = ticket.id LEFT JOIN closure_code cc ON cc.id = tc.code_id) main LEFT JOIN ( SELECT a.id, a.otrs_id, adm.id, adm.a_body FROM article a LEFT JOIN article_data_mime adm ON a.otrs_id = adm.article_id WHERE adm.a_subject::text = 'Выполнено'::text AND ((a.change_time, a.ticket_id) IN ( SELECT max(article.change_time) AS m_time, article.ticket_id FROM article GROUP BY article.ticket_id))) r(ticket_id, id, otrs_id, a_body) USING (ticket_id); CREATE OR REPLACE VIEW public.subject_view AS SELECT DISTINCT e.id AS incident_subject_id, e.counterpart_subject_id AS subject_category, c.counter_name AS subject_category_name, e.domain AS subject_domain, e."group" AS subject_group, e.name AS subject_name, e.path AS subject_path, e.privileges AS subject_privileges, e.version AS subject_version FROM entity e LEFT JOIN counterpart c ON c.id = e.counterpart_subject_id; CREATE OR REPLACE VIEW public.object_view AS SELECT DISTINCT e.id AS incident_object_id, e.counterpart_object_id AS object_category, c.counter_name AS object_category_name, e.domain AS object_domain, e."group" AS object_group, e.name AS object_name, e.path AS object_path, e.property AS object_proretry, e.state AS object_state, e.value AS object_value, e.vendor AS object_vendor, e.version AS object_version FROM entity e LEFT JOIN counterpart c ON c.id = e.counterpart_object_id; CREATE OR REPLACE VIEW public.interaction_view AS SELECT i.id AS incident_interaction, i.direction AS interaction_direction, i.duration AS interaction_duration, i.logon_type AS interaction_logon_type, i.protocol AS interaction_protocol, i.reason AS interaction_reason, i.starttime AS interaction_start_time, its.status_translate_id AS interaction_status, itc.translate AS interaction_category FROM interactiondescription I LEFT JOIN interactioncategory itc ON itc.id = i.action LEFT JOIN interactionstatus its ON its.id = i.status; CREATE OR REPLACE VIEW public.data_view AS SELECT dp.id AS incident_data, dp.aux1 AS data_aux1, dp.aux2 AS data_aux2, dp.aux3 AS data_aux3, dp.aux4 AS data_aux4, dp.aux5 AS data_aux5, dp.aux6 AS data_aux6, dp.aux7 AS data_aux7, dp.aux8 AS data_aux8, dp.aux9 AS data_aux9, dp.aux10 AS data_aux10, dp.bytes_in AS data_bytes_in, dp.bytes_out AS data_bytes_out, dp.bytes_total AS data_bytes_total, dp.interface AS data_interface, dp.msgid AS data_msgid, dp.origintime AS data_origintime, dp.packets_in AS data_packets_in, dp.packets_out AS data_packets_out, dp.packets_total AS data_packets_total, dp.recvfile AS data_recvfile, dp.tcpflag AS data_tcp_flag, dp."time" AS data_time FROM datapayload dp; CREATE OR REPLACE VIEW public.asset_view AS SELECT i.id AS asset_incident_id, i.source_id AS incident_source_id, i.destination_id AS incident_destination_id, i.eventsourcecategory_id AS incident_event_source_category, collectorlocationhost_id AS incident_collector_location_host_id, asrc.first_seen AS source_first_seen, asrc.fqdn AS source_fqdn, asrc.hostdomain AS source_hostdomain, asrc.hostname AS source_hostname, asrc.ip AS source_ip, asrc.itop_id AS source_id, asrc.last_seen AS source_last_seen, asrc.mac AS source_mac, asrc.org_id AS source_org_id, asrc.server_criticality AS source_server_criticality, asrc.server_status AS source_server_status, adn.first_seen AS destination_first_seen, adn.fqdn AS destination_fqdn, adn.hostdomain AS destination_hostdomain, adn.hostname AS destination_hostname, adn.ip AS destination_ip, adn.itop_id AS destination_itop_id, adn.last_seen AS destination_last_seen, adn.mac AS destination_mac, adn.org_id AS destination_org_id, adn.server_criticality AS destination_server_criticality, adn.server_status AS destination_server_status, aes.first_seen AS event_source_first_seen, aes.fqdn AS event_source_fqdn, aes.hostdomain AS event_source_hostdomain, aes.hostname AS event_source_hostname, aes.ip AS event_source_ip, aes.itop_id AS event_source_itop_id, aes.last_seen AS event_source_last_seen, aes.mac AS event_source_mac, aes.org_id AS event_source_org_id, aes.server_criticality AS event_source_server_criticality, aes.server_status AS event_source_server_status, acl.first_seen AS collector_location_first_seen, acl.fqdn AS collector_location_fqdn, acl.hostdomain AS collector_location_hostdomain, acl.hostname AS collector_location_hostname, acl.ip AS collector_location_ip, acl.itop_id AS collector_location_itop_id, acl.last_seen AS collector_location_last_seen, acl.mac AS collector_location_mac, acl.org_id AS collector_location_org_id, acl.server_criticality AS collector_location_server_criticality, acl.server_status AS collector_location_server_status FROM incident i LEFT JOIN asset asrc ON asrc.id = i.source_id LEFT JOIN asset adn ON adn.id = i.destination_id LEFT JOIN asset aes ON aes.id = i.event_source LEFT JOIN asset acl ON acl.id = i.collectorlocationhost_id;
- changeSet:      
      id: 1.0.0/62
      author: aksenova
      changes:
        sql:  CREATE OR REPLACE VIEW public.incident_view AS SELECT i.inc_id AS incident_id, i.detect_time AS incident_detect_time, i.event_source AS incident_event_source, i.event_time AS incident_event_time, i."inputId" AS incident_input_id, i.nat_id AS incident_nat_id, i.organization_id AS incident_organization_id, org.name AS incident_organization_full_name, i.usecase_id AS incident_usecase_id, i.rule_id AS incident_rule_id, i.severity_level_id AS incident_severity_level_id, sl.level_name AS incident_severity_level_name, i.subsys, i.destination_port AS incident_destination_port, i.source_port AS incident_sourse_port, esc.category_name AS event_source_category, esc.description AS event_source_description, i.ticket_id, sbv.incident_subject_id, sbv.subject_category, sbv.subject_category_name, sbv.subject_domain, sbv.subject_group, sbv.subject_name, sbv.subject_path, sbv.subject_privileges, sbv.subject_version, ov.incident_object_id, ov.object_category, ov.object_category_name, ov.object_domain, ov.object_group, ov.object_name, ov.object_path, ov.object_proretry, ov.object_state, ov.object_value, ov.object_vendor, ov.object_version, iv.interaction_direction, iv.interaction_duration, iv.interaction_logon_type, iv.interaction_protocol, iv.interaction_reason, iv.interaction_start_time, iv.interaction_status, iv.interaction_category, av.incident_source_id, av.incident_destination_id, av.incident_event_source_category, av.incident_collector_location_host_id, av.source_first_seen, av.source_fqdn, av.source_hostdomain, av.source_hostname, av.source_ip, av.source_id, av.source_last_seen, av.source_mac, av.source_org_id, av.source_server_criticality, av.source_server_status, av.destination_first_seen, av.destination_fqdn, av.destination_hostdomain, av.destination_hostname, av.destination_ip, av.destination_itop_id, av.destination_last_seen, av.destination_mac, av.destination_org_id, av.destination_server_criticality, av.destination_server_status, av.event_source_first_seen, av.event_source_fqdn, av.event_source_hostdomain, av.event_source_hostname, av.event_source_ip, av.event_source_itop_id, av.event_source_last_seen, av.event_source_mac, av.event_source_org_id, av.event_source_server_criticality, av.event_source_server_status, av.collector_location_first_seen, av.collector_location_fqdn, av.collector_location_hostdomain, av.collector_location_hostname, av.collector_location_ip, av.collector_location_itop_id, av.collector_location_last_seen, av.collector_location_mac, av.collector_location_org_id, av.collector_location_server_criticality, av.collector_location_server_status, ni.hostname AS incident_nat_hostname, ni.ip AS incident_nat_ip, ni.port AS incident_nat_port, ven.vendor_name AS incident_vendor, gv.title AS incident_vendor_product, dv.data_aux1, dv.data_aux2, dv.data_aux3, dv.data_aux4, dv.data_aux5, dv.data_aux6, dv.data_aux7, dv.data_aux8, dv.data_aux9, dv.data_aux10, dv.data_bytes_in, dv.data_bytes_out, dv.data_bytes_total, dv.data_interface, dv.data_msgid, dv.data_origintime, dv.data_packets_in, dv.data_packets_out, dv.data_packets_total, dv.data_recvfile, dv.data_tcp_flag, dv.data_time FROM incident i LEFT JOIN organizations org ON org.short_name::text = i.organization_id::text LEFT JOIN severitylevel sl ON sl.id = i.severity_level_id LEFT JOIN natinfo ni ON ni.id = i.nat_id LEFT JOIN vendor_solutions gv ON gv.id = i.vendor_id LEFT JOIN vendors ven ON ven.id = gv.vendor_id LEFT JOIN asset_view av ON av.asset_incident_id = i.id LEFT JOIN subject_view sbv ON sbv.incident_subject_id = i.subject_id LEFT JOIN object_view ov ON ov.incident_object_id = i.object_id LEFT JOIN interaction_view iv ON iv.incident_interaction = i.interaction LEFT JOIN data_view dv ON dv.incident_data = i.data LEFT JOIN eventsourcecategory esc ON esc.id = i.eventsourcecategory_id; CREATE OR REPLACE VIEW public.full_incidents_view AS SELECT iv.incident_id, iv.incident_detect_time, iv.incident_event_source, iv.incident_event_time, iv.incident_input_id, iv.incident_nat_id, iv.incident_organization_id, iv.incident_organization_full_name, iv.incident_usecase_id AS usecase, iv.incident_rule_id, iv.incident_severity_level_name AS level_name, iv.subsys, iv.incident_destination_port, iv.incident_sourse_port, tv.ticket_id, tv.incident_otrs_id, tv.ticket_number, tv.ticket_state, tv.ticket_state_type, tv.ticket_code_name, tv.ticket_complexity, tv.ticket_time_spent, tv.ticket_create_time, tv.ticket_change_time, tv.ticket_action_performed, iv.incident_subject_id, iv.subject_category, iv.subject_domain, iv.subject_group, iv.subject_name, iv.subject_path, iv.subject_privileges, iv.subject_version, iv.incident_object_id, iv.object_category, iv.object_domain, iv.object_group, iv.object_name, iv.object_path, iv.object_proretry, iv.object_state, iv.object_value, iv.object_vendor, iv.object_version, iv.interaction_direction, iv.interaction_duration, iv.interaction_logon_type, iv.interaction_protocol, iv.interaction_reason, iv.interaction_start_time, iv.interaction_status, iv.interaction_category, iv.incident_source_id, iv.incident_destination_id, iv.incident_event_source_category, iv.incident_collector_location_host_id, iv.source_first_seen, iv.source_fqdn, iv.source_hostdomain, iv.source_hostname, iv.source_ip, iv.source_id, iv.source_last_seen, iv.source_mac, iv.source_org_id, iv.source_server_criticality, iv.source_server_status, iv.destination_first_seen, iv.destination_fqdn, iv.destination_hostdomain, iv.destination_hostname, iv.destination_ip, iv.destination_itop_id, iv.destination_last_seen, iv.destination_mac, iv.destination_org_id, iv.destination_server_criticality, iv.destination_server_status, iv.event_source_first_seen, iv.event_source_fqdn, iv.event_source_hostdomain, iv.event_source_hostname, iv.event_source_ip, iv.event_source_itop_id, iv.event_source_last_seen, iv.event_source_mac, iv.event_source_org_id, iv.event_source_server_criticality, iv.event_source_server_status, iv.collector_location_first_seen, iv.collector_location_fqdn, iv.collector_location_hostdomain, iv.collector_location_hostname, iv.collector_location_ip, iv.collector_location_itop_id, iv.collector_location_last_seen, iv.collector_location_mac, iv.collector_location_org_id, iv.collector_location_server_criticality, iv.collector_location_server_status, iv.incident_nat_hostname, iv.incident_nat_ip, iv.incident_nat_port, iv.incident_vendor, iv.incident_vendor_product, iv.data_aux1, iv.data_aux2, iv.data_aux3, iv.data_aux4, iv.data_aux5, iv.data_aux6, iv.data_aux7, iv.data_aux8, iv.data_aux9, iv.data_aux10, iv.data_bytes_in, iv.data_bytes_out, iv.data_bytes_total, iv.data_interface, iv.data_msgid, iv.data_origintime, iv.data_packets_in, iv.data_packets_out, iv.data_packets_total, iv.data_recvfile, iv.data_tcp_flag, iv.data_time FROM incident_view iv LEFT JOIN ticket_view tv ON tv.ticket_id = iv.ticket_id; CREATE OR REPLACE VIEW public.translated_incidents_view AS SELECT f.incident_id, f.incident_detect_time, f.incident_event_time, f.incident_organization_id, f.incident_organization_full_name, f.interaction_reason, f.interaction_logon_type, ist.status_name AS interaction_status_name, ist.status_descr AS interaction_status_description, slt.level_description AS incident_severity_level_name, ict.intcategory_name AS interaction_category_name, ict.intcategory_description AS interaction_category_description, u.usecase_id AS incident_usecase_name_id, u.description AS incident_usecase_description, cat.description AS incident_usecase_category, f.incident_nat_hostname, f.incident_nat_ip, f.incident_nat_port, f.incident_destination_port, f.incident_sourse_port, f.incident_vendor, f.incident_vendor_product, f.incident_otrs_id, f.ticket_change_time, f.ticket_complexity, f.ticket_create_time, f.ticket_number, f.ticket_state, f.ticket_action_performed, f.ticket_time_spent, f.ticket_state_type, ctt.cnt_descr AS subject_counterpart_description, f.subject_domain, f.subject_group, f.subject_name, f.subject_path, ctt2.cnt_descr AS object_counterpart_description, f.object_domain, f.object_group, f.object_name, f.object_path, f.object_state, f.object_value, f.object_vendor, f.source_first_seen, f.source_fqdn, f.source_hostdomain, f.source_hostname, f.source_ip, f.source_last_seen, f.source_mac, f.source_server_criticality, f.source_server_status, f.destination_first_seen, f.destination_fqdn, f.destination_hostdomain, f.destination_hostname, f.destination_ip, f.destination_last_seen, f.destination_mac, f.destination_server_criticality, f.destination_server_status, f.event_source_first_seen, f.event_source_fqdn, f.event_source_hostdomain, f.event_source_hostname, f.event_source_last_seen, f.event_source_mac, f.event_source_server_criticality, f.event_source_server_status, esc.category_name AS event_source_category, esc.description AS event_source_description, f.collector_location_first_seen, f.collector_location_fqdn, f.collector_location_hostdomain, f.collector_location_hostname, f.collector_location_ip, f.collector_location_last_seen, f.collector_location_mac, f.collector_location_server_criticality, f.collector_location_server_status, f.data_aux1, f.data_aux2, f.data_aux3, f.data_aux4, f.data_aux5, f.data_aux6, f.data_aux7, f.data_aux8, f.data_aux9, f.data_aux10, f.data_bytes_in, f.data_bytes_out, f.data_bytes_total, f.data_interface, f.data_origintime, f.data_packets_in, f.data_packets_out, f.data_packets_total, f.data_recvfile, f.data_tcp_flag, f.data_time, l.locale FROM full_incidents_view f LEFT JOIN usecase u ON f.usecase::text = u.usecase_id::text LEFT JOIN languages l ON u.lang_id = l.id LEFT JOIN interactionstatus_translate ist ON ist.status_name::text = f.interaction_status::text AND ist.lang_id = l.id LEFT JOIN categories cat ON u.category_id::text = cat.category_id::text AND cat.lang_id::text = l.locale::text LEFT JOIN interactioncategory_translate ict ON f.interaction_category::text = ict.intcategory_name::text AND ict.lang_id = l.id LEFT JOIN severitylevel_translate slt ON slt.level_name::text = f.level_name::text AND slt.lang_id = l.id LEFT JOIN eventsourcecategory esc ON esc.id = f.incident_event_source_category LEFT JOIN counterpart ct ON ct.id = f.subject_category LEFT JOIN counterpart ct2 ON ct2.id = f.object_category LEFT JOIN counterpart_translate ctt ON ctt.cnt_name::text = ct.counter_translate_id::text AND ctt.lang_id = l.id LEFT JOIN counterpart_translate ctt2 ON ctt2.cnt_name::text = ct2.counter_translate_id::text AND ctt2.lang_id = l.id;

 